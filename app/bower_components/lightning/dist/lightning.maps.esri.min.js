/*! lightning 2017-05-08 */
!function(){"use strict";function a(a,b,c){return{restrict:"E",scope:{response:"="},transclude:!0,link:function(d,e,f){function g(e){a.require(["esri/InfoTemplate","esri/layers/FeatureLayer","esri/map","esri/renderers/HeatmapRenderer","esri/tasks/FeatureSet","esri/geometry/Point","esri/symbols/SimpleMarkerSymbol","esri/Color","esri/graphic","esri/SpatialReference","esri/graphicsUtils"],function(a,g,i,j,k,l,m,n,o,p,q){d.esri={},d.$watch("response",function(a){if(a){if(d.facet=d.response.facets[f.facetName],null==d.facet)return;h?e.removeLayer(d.heatmapFeatureLayer):h=!0;var i,r,s,t=[],u=new k,v=new p(4326),w=(new m).setStyle(m.STYLE_SQUARE).setColor(new n([255,0,0,.5]));angular.forEach(d.facet.filters,function(a,b){var d=c("actualValue")(a.val),e=d.split(","),f=e[0].trim(),g=e[1].trim();f=parseFloat(f),g=parseFloat(g),i=new l(g,f,v),r={OBJECTID:b,weight:a.count,x:g,y:f},s=new o(i,w,r),t.push(s)}),u.features=t,u.geometryType="esriGeometryPoint";var x={objectIdField:"OBJECTID",layerDefinition:{geometryType:"esriGeometryPoint",fields:[{name:"OBJECTID",type:"esriFieldTypeOID"},{name:"weight",type:"esriFieldTypeDouble"},{name:"x",type:"esriFieldTypeDouble"},{name:"y",type:"esriFieldTypeDouble"}]},featureSet:u},y={mode:g.MODE_SNAPSHOT,outFields:["weight"]};d.heatmapFeatureLayer=new g(x,y);var z=new j({field:"weight"});d.heatmapFeatureLayer.setRenderer(z),e.addLayer(d.heatmapFeatureLayer),b(function(){var a=q.graphicsExtent(u.features);e.setExtent(a,!0)},0)}})})}var h=!1;d.loaded=!1,d.map={},f.javascriptApiUrl=null==f.javascriptApiUrl?"//js.arcgis.com/3.15compact":f.javascriptApiUrl,f.basemap=null==f.basemap?"topo":f.basemap,a.bootstrap({url:f.javascriptApiUrl}).then(function(){d.loaded=!0,d.map.options={basemap:f.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"}},function(){d.loaded=!0,f.basemap=null==f.basemap?"topo":f.basemap,d.map.options={basemap:f.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"}}),d.onMapLoad=g},template:function(a,b){var c=Math.floor(1e3*Math.random()+1);b.height=null==b.height?"400px":b.height,b.width=null==b.width?"100%":b.width;var d="<style>.map"+c+"{height:"+b.height+"; width:"+b.width+';}</style><div class="map'+c+'" style="height:'+b.height+"; width:"+b.width+'; position:relative;"><esri-map id="esrimap"style="height: 100%; width: 100%;" map-options="map.options" ng-if="loaded" load="onMapLoad"></esri-map></div>';return d}}}angular.module("lightning").directive("esriHeatmap",a),a.$inject=["esriLoader","$timeout","$filter"]}(),function(){"use strict";function a(){var a={restrict:"E",template:function(a,b){var c="";return"true"==b.toggleLayers&&(c+='<style>#layerListPane{width:200px !important;}</style><div id="layerListPane" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:\'right\'"  style="position: absolute;right: 0px;z-index: 100;"><div id="layerList"></div></div>'),c}};return a}angular.module("lightning").directive("esriWebmap",a)}();