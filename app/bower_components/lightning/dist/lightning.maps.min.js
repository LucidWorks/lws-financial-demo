/*! lightning 2017-05-08 */
!function(){"use strict";function a(a,b,c,d,e,f,g,h,i,j){return{restrict:"E",scope:{response:"=",options:"=?"},transclude:!0,controller:["$scope","$attrs",function(a,b){function c(e,f){"esri"==b.provider?null!=a.esri&&null!=a.esri.Point?a.createLayer(e,f):d(function(){c(e,f)},0):"bing"==b.provider?d(function(){a.createLayer(e,f)},500):a.createLayer(e,f)}var e=this;e.addLayer=c}],link:{post:function(k,l,m,n,o){function p(){var b="";"esri"==m.provider?b+="<style>.map"+z+" .map{height:"+m.height+"; width:"+m.width+";}</style>":"bing"!=m.provider&&(b+="<style>.map"+z+" .angular-google-map-container{height:"+m.height+"; width:"+m.width+";}</style>"),"esri"==m.provider||"bing"==m.provider?(b+='<div class="map'+z+'" style="height:'+m.height+"; width:"+m.width+'; position:relative;">',"true"==m.loadingOverlay&&(b+=r()),o(k,function(a){angular.forEach(a,function(a){("GEO:LAYER"==a.nodeName||"ESRI:WEBMAP"==a.nodeName)&&(b+=a.outerHTML)})}),b+=s(),b+="</div>",l.html(b),a(l.contents())(k),A=!0):i.then(function(){b+='<div class="map'+z+'" style="height:'+m.height+"; width:"+m.width+'; position:relative;">',"true"==m.loadingOverlay&&(b+=r()),o(k,function(a){angular.forEach(a,function(a){"GEO:LAYER"==a.nodeName&&(b+=a.outerHTML)})}),b+=s(),b+="</div>",b+='<button ng-if="applyButton == true" ng-click="searchArea()" styling="button" style="margin-top:10px;">Search this Area</button>',l.html(b),a(l.contents())(k),A=!0})}function q(){switch(m.provider){case"google":C.fitBounds();break;case"bing":D.setBounds(k.map);break;case"esri":E.fitBounds();break;default:C.fitBounds()}}function r(){var a='<div class="loading-block-container" ng-show="loading"><div class="loading-block-overlay"></div><div class="loading-block-content"><div class="loading-block-message"><div class="tk-stl-circle-loader"></div></div></div></div>';return a}function s(){switch(m.provider){case"google":return C.createMap();case"bing":return v();case"esri":return x();default:return C.createMap()}}function t(){switch(m.provider){case"google":C.addMarkers(k.response,m);break;case"bing":D.addMarkers(k.response,m);break;case"esri":E.addEsriMarkers(k.response,m);break;default:C.addMarkers(k.response,m)}}function u(a,b){switch(m.provider){case"google":C.addMarkers(a,b);break;case"bing":D.addMarkers(a,b);break;case"esri":E.addEsriMarkers(a,b);break;default:C.addMarkers(a,b)}}function v(){m.apiKey=null!=m.apiKey?m.apiKey:"Am0nuHMC-S0DlWkPGEKVYjK4WCSUnI7q6UDhcOK7vf0fKR6D5sAjCGUDtJU7MOTF",k.mapOptions={zoom:m.zoomLevel||13,mapType:"auto",options:{disablePanning:!1,disableZooming:!1,credentials:m.apiKey,showCopyright:!1,enableClickableLogo:!1,enableSearchLogo:!1,showDashboard:!0,scrollwheel:!1}},k.onMapReady=w,null!=m.response&&(null!=m.addressField?D.geocodeMarkers(k.response,m):D.addMarkers(k.response,m));var a='<bing-map zoom="mapOptions.zoom" map-type="mapOptions.mapType" options="mapOptions.options" on-map-ready="onMapReady(map)">';return a+='<pushpin ng-repeat="marker in markers" lat="marker.latitude" lng="marker.longitude" options="marker.options" pushpin-data="marker.data" events="marker.events">',a+='<info-box options="marker.infobox.options" title="marker.infobox.title" visible="marker.infobox.visible"></info-box>',a+="</pushpin>",a+="</bing-map>"}function w(a){null!=D&&D.setBounds(a),0==m.scrollToZoom&&Microsoft.Maps.Events.addHandler(a,"mousewheel",function(a){return a.handled=!0,!0}),k.map=a}function x(){var a='<esri-map id="esrimap"style="position: absolute; height: 100%; width: 100%;"';null!=m.webmapId&&(a+=' webmap-id="'+m.webmapId+'" '),a+='map-options="map.options" ng-if="loaded" load="onMapLoad"></esri-map>',k.loaded=!1,k.map={},m.javascriptApiUrl=null==m.javascriptApiUrl?"//js.arcgis.com/3.15compact":m.javascriptApiUrl,m.basemap=null==m.basemap?"topo":m.basemap;var b;return d(function(){b=angular.element(l).find("esri:webmap"),null!=b&&(b=b[0],null!=b.attributes.id&&(k.webmapId=b.attributes.id.value),null!=b.attributes.portalUrl&&(k.portalUrl=b.attributes.portalUrl.value))},0),h.bootstrap({url:m.javascriptApiUrl}).then(function(){k.loaded=!0,k.map.options={basemap:m.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"},null!=k.webmapId&&(k.map.options.webmapId=k.webmapId)},function(){k.loaded=!0,k.map.options={basemap:m.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"},null!=k.webmapId&&(k.map.options.webmapId=k.webmapId)}),k.onMapLoad=y,a}function y(a){h.require(["esri/toolbars/draw","esri/symbols/SimpleMarkerSymbol","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/graphic","esri/geometry/Point","esri/graphicsUtils","esri/InfoTemplate","dijit/layout/ContentPane","esri/arcgis/utils","esri/dijit/LayerList"],function(b,c,d,e,f,g,h,i,j,l,n){null!=k.portalUrl&&(l.arcgisUrl=k.portalUrl);var o=new n({map:a,layers:l.getLayerList(a)},"layerList");o.startup(),k.esri={},k.esri.Point=g,E.modules.Draw=b,E.modules.SimpleMarkerSymbol=c,E.modules.PictureMarkerSymbol=d,E.modules.SimpleLineSymbol=e,E.modules.Graphic=f,E.modules.Point=g,E.modules.GraphicUtils=h,E.modules.InfoTemplate=i,E.map=a,null!=m.response&&(null!=m.addressField?E.geocodePoints(k.response,m):E.addEsriMarkers(k.response,m))})}var z=Math.floor(1e3*Math.random()+1);k.markers=[],k.$on("$destroy",function(){B()});var A=!1;m.height=null==m.height?"400px":m.height,m.width=null==m.width?"100%":m.width,m.scrollToZoom="true"==m.scrollToZoom,m.provider=m.provider||"google",k.createLayer=function(a,b){b.addressField?"esri"==m.provider?E.geocodePoints(a,b):"bing"==m.provider?D.geocodeMarkers(a,b):C.geocodeMarkers(a,b):u(a,b)},null!=m.response?k.$watch("response",function(a){a&&(k.markers=[],A?m.addressField?"esri"==m.provider?E.geocodePoints(k.response,m):"bing"==m.provider?D.geocodeMarkers(k.response,m):C.geocodeMarkers(k.response,m):t():p())}):p(),k.$watch(function(){return l[0].offsetTop>0&&l[0].offsetLeft>0},function(){l[0].offsetTop>0&&l[0].offsetLeft>0&&q()});var B=k.$on("geoMap.resize",function(){q()}),C={map:!1,bounds:[],markers:[],createMap:function(){var a;k.loading=!0,a=null==m.basemap?google.maps.MapTypeId.ROADMAP:"satellite"==m.basemap.toLowerCase()?google.maps.MapTypeId.SATELLITE:"hybrid"==m.basemap.toLowerCase()?google.maps.MapTypeId.HYBRID:"terrain"==m.basemap.toLowerCase()?google.maps.MapTypeId.TERRAIN:google.maps.MapTypeId.ROADMAP,k.mapOptions={scrollwheel:m.scrollToZoom,mapTypeId:a},null!=k.options&&angular.extend(k.mapOptions,k.options),k.googlemap={};var b='<ui-gmap-google-map center="map.center" zoom="map.zoom" options="mapOptions" control="googlemap">';null!=m.response&&(m.addressField?C.geocodeMarkers(k.response,m):t()),b+='<ui-gmap-markers models="markers" coords="\'self\'" icon="\'icon\'" click="click" events="events">',b+="<ui-gmap-windows show=\"'infoWindow.show'\"><div ng-non-bindable>{{infoWindow.labelContent}}</div></ui-gmap-windows>",b+="</ui-gmap-markers>",b+="</ui-gmap-google-map>",k.map={center:{latitude:0,longitude:0},zoom:null==m.zoomLevel||isNaN(m.zoomLevel)?13:Number(m.zoomLevel)};for(var c=new google.maps.LatLngBounds,e=0;e<k.markers.length;e++)c.extend(new google.maps.LatLng(k.markers[e].latitude,k.markers[e].longitude));return k.googleBounds=c,d(function(){if(k.googlemap&&"function"==typeof k.googlemap.getGMap){var a=k.googlemap.getGMap();C.fitBounds(),d(function(){if(1==k.markers.length||null!=m.zoomLevel&&k.map.zoom>m.zoomLevel)d(function(){1==k.markers.length&&isNaN(m.zoomLevel)?(a.setZoom(13),google.maps.event.trigger(a,"resize")):(a.setZoom(Number(m.zoomLevel)),google.maps.event.trigger(a,"resize"))},1e3);else{for(var b=new google.maps.LatLngBounds,c=0;c<k.markers.length;c++)b.extend(new google.maps.LatLng(k.markers[c].latitude,k.markers[c].longitude));k.googleBounds=b,C.fitBounds()}k.loading=!1},0)}},0),b},geocodeMarkers:function(a,b){for(var c=g.gmapAddresses||{},d=0;d<a.results.length;d++){var h=void 0!=a.results[d].result.fields[b.addressField]?f("actualValue")(a.results[d].result.fields[b.addressField].val):"";if(null!=c&&null!=c[h]){var i=C.createMarker(d,c[h].lat,c[h].lng,a,b);k.markers.push(i)}else null!=h&&""!=h.trim()?C.attemptGeocode(d,h,a,b):e.warn("Unable to render result "+(d+1)+" - No Address to Render")}C.setMarkerIds()},attemptGeocode:function(a,b,c,f){var h=new google.maps.Geocoder;h.geocode({address:b},function(h,i){if(i==google.maps.GeocoderStatus.OK){var j=C.createMarker(a,h[0].geometry.location.lat(),h[0].geometry.location.lng(),c,f);if(k.markers.push(j),a%10==0){for(var l=new google.maps.LatLngBounds,m=0;m<k.markers.length;m++)l.extend(new google.maps.LatLng(k.markers[m].latitude,k.markers[m].longitude));k.googleBounds=l,q()}var n=g.gmapAddresses||{};n[b]={lat:h[0].geometry.location.lat(),lng:h[0].geometry.location.lng()},g.gmapAddresses=n}else i==google.maps.GeocoderStatus.OVER_QUERY_LIMIT?d(function(){C.attemptGeocode(a,b,c,f)},250):e.warn("Unable to render result "+(a+1)+" ("+b+") - "+i);C.setMarkerIds()})},createMarker:function(a,b,c,d,e){var g={id:null,latitude:b,longitude:c,title:"m"+a};if(null!=m.weightField){var h,i;angular.forEach(d.results,function(a){var b=f("actualValue")(a.result.fields[m.weightField].val);null==h||null==i?(h=b,i=b):h>b?h=b:b>i&&(i=b)});for(var j,k=i/10,l=f("actualValue")(d.results[a].result.fields[m.weightField].val),n=1;10>=n;){var o=k*(n-1),p=k*n;l>o&&p>=l&&(j=n*(1+3/n)+2),n++}null!=e.iconField&&null!=d.results[a].result.fields[e.iconField]?g.icon={url:f("actualValue")(d.results[a].result.fields[e.iconField].val),scaledSize:new google.maps.Size(5*j,5*j)}:null!=e.icon?g.icon={url:e.icon,scaledSize:new google.maps.Size(5*j,5*j)}:g.icon={path:google.maps.SymbolPath.CIRCLE,scale:j,strokeOpacity:.8,strokeColor:"#F7584C"}}else null!=e.iconField&&null!=d.results[a].result.fields[e.iconField]?g.icon=f("actualValue")(d.results[a].result.fields[e.iconField].val):null!=e.icon&&(g.icon=e.icon);return null!=e.urlField&&(g.click=function(){var b=null!=e.urlPrefix?e.urlPrefix:"";b+=null!=d.results[a].result.fields[e.urlField]?f("actualValue")(d.results[a].result.fields[e.urlField].val):"",window.open(b,void 0!=e.target?e.target:"_blank")}),null!=e.labelField&&(g.infoWindow={},g.infoWindow.show=!1,g.events={},g.events.mouseover=function(){g.show=!0},g.events.mouseout=function(){g.show=!1},g.infoWindow.labelContent=null!=d.results[a].result.fields[e.labelField]?f("actualValue")(d.results[a].result.fields[e.labelField].val):""),g},fitBounds:function(){if(k.googlemap&&"function"==typeof k.googlemap.getGMap){var a=k.googlemap.getGMap();(1!=k.eventsAdded||null==m.events||-1==m.events.indexOf("zoom")&&-1==m.events.indexOf("drag")&&-1==m.events.indexOf("apply"))&&(google.maps.event.trigger(a,"resize"),a.fitBounds(k.googleBounds)),d(function(){if(null!=m.events&&(-1!=m.events.indexOf("drag")||-1!=m.events.indexOf("apply"))){k.eventsAdded=!0;var b=a.addListener("dragend",function(){if(console.log("dragend"),-1!=m.events.indexOf("drag")){var c=a.getBounds(),d=c.getNorthEast(),e=c.getSouthWest(),f=new google.maps.LatLng(d.lat(),e.lng()),g=new google.maps.LatLng(e.lat(),d.lng()),h={neLat:d.lat(),neLng:d.lng(),swLat:e.lat(),swLng:e.lng(),nwLat:f.lat(),nwLng:f.lng(),seLat:g.lat(),seLng:g.lng()};j.$broadcast("dragend_gmaps",h)}-1!=m.events.indexOf("apply")&&(k.applyButton=!0),google.maps.event.removeListener(b)})}if(k.searchArea=function(){var b=a.getBounds(),c=b.getNorthEast(),d=b.getSouthWest(),e=new google.maps.LatLng(c.lat(),d.lng()),f=new google.maps.LatLng(d.lat(),c.lng()),g={neLat:c.lat(),neLng:c.lng(),swLat:d.lat(),swLng:d.lng(),nwLat:e.lat(),nwLng:e.lng(),seLat:f.lat(),seLng:f.lng()};j.$broadcast("search_area_gmaps",g)},null!=m.events&&(-1!=m.events.indexOf("zoom")||-1!=m.events.indexOf("apply")))var c=a.addListener("zoom_changed",function(){if(k.eventsAdded=!0,console.log("zoom_changed"),-1!=m.events.indexOf("zoom")){var b=a.getBounds(),d=b.getNorthEast(),e=b.getSouthWest(),f=new google.maps.LatLng(d.lat(),e.lng()),g=new google.maps.LatLng(e.lat(),d.lng()),h={neLat:d.lat(),neLng:d.lng(),swLat:e.lat(),swLng:e.lng(),nwLat:f.lat(),nwLng:f.lng(),seLat:g.lat(),seLng:g.lng()};j.$broadcast("zoom_changed_gmaps",h)}-1!=m.events.indexOf("apply")&&(k.applyButton=!0),google.maps.event.removeListener(c)})},2e3)}},addMarkers:function(a,b){for(var c=0;c<a.results.length;c++)if(a.results[c].result.fields[b.latitudeField]&&a.results[c].result.fields[b.longitudeField]){var e=f("actualValue")(a.results[c].result.fields[b.latitudeField].val),g=f("actualValue")(a.results[c].result.fields[b.longitudeField].val),h=C.createMarker(c,e,g,a,b);k.markers.push(h),C.fitBounds()}C.setMarkerIds(),d(function(){if(k.googlemap&&"function"==typeof k.googlemap.getGMap){var a=k.googlemap.getGMap();C.fitBounds(),d(function(){var b,c;if(null==m.events&&(1==k.markers.length||null!=m.zoomLevel&&k.map.zoom>m.zoomLevel)){for(c=new google.maps.LatLngBounds,b=0;b<k.markers.length;b++)c.extend(new google.maps.LatLng(k.markers[b].latitude,k.markers[b].longitude));k.googleBounds=c,C.fitBounds(),d(function(){1==k.markers.length&&isNaN(m.zoomLevel)?(a.setZoom(13),google.maps.event.trigger(a,"resize")):(a.setZoom(Number(m.zoomLevel)),google.maps.event.trigger(a,"resize"))},1e3)}else if(null==m.events){for(c=new google.maps.LatLngBounds,b=0;b<k.markers.length;b++)c.extend(new google.maps.LatLng(k.markers[b].latitude,k.markers[b].longitude));k.googleBounds=c,C.fitBounds()}k.loading=!1},0)}},0)},setMarkerIds:function(){angular.forEach(k.markers,function(a,b){a.id=b})}},D={createMap:v,onMapReady:w,geocodeMarkers:function(a,d){var h=g.gmapAddresses||{};k.loading=!0;for(var i=[],j=0;j<a.results.length;j++){var l=void 0!=a.results[j].result.fields[d.addressField]?f("actualValue")(a.results[j].result.fields[d.addressField].val):"";null!=h&&null!=h[l]?i.push(null):null==l||""==l.trim()?i.push(null):i.push(b.jsonp("http://dev.virtualearth.net/REST/v1/Locations?query="+l+"&key="+m.apiKey+"&jsonp=JSON_CALLBACK"))}c.all(i).then(function(b){angular.forEach(b,function(b,c){var i,j=void 0!=a.results[c].result.fields[d.addressField]?f("actualValue")(a.results[c].result.fields[d.addressField].val):"";if(null==b&&null!=h&&null!=h[j])i=D.createMarker(c,h[j].lat,h[j].lng,a,d);else{if(null==b)return void e.warn("Unable to render result "+(c+1)+" - No Address to Render");if(200!=b.data.statusCode)return void e.warn(b.data.statusCode+" unable to render result "+(c+1)+" - "+b.data.authenticationResultCode+" "+b.data.errorDetails[0]);if(!(b.data.resourceSets&&b.data.resourceSets[0]&&b.data.resourceSets[0].resources&&0!==b.data.resourceSets[0].resources.length&&b.data.resourceSets[0].resources[0].point))return void e.warn("Unable to get coordinates for result "+(c+1));var l=b.data.resourceSets[0].resources[0].point,m=l.coordinates[0],n=l.coordinates[1];h=g.gmapAddresses||{},h[j]={lat:m,lng:n},g.gmapAddresses=h,i=D.createMarker(c,m,n,a,d)}k.markers.push(i)})}).then(function(){D.setMarkerIds(),D.setBounds(k.map)})},setBounds:function(a){var b=[];angular.forEach(k.markers,function(a){var c=new Microsoft.Maps.Location(a.latitude,a.longitude);b.push(c)}),b.length>0&&(k.viewRect=Microsoft.Maps.LocationRect.fromLocations(b),d(function(){a.setView({bounds:k.viewRect}),1==b.length&&isNaN(m.zoomLevel)?k.mapOptions.zoom=13:null!=m.zoomLevel&&a.getZoom()>m.zoomLevel&&(k.mapOptions.zoom=Number(m.zoomLevel)),k.loading=!1},1e3))},createMarker:function(a,b,c,d,e){var g={id:a,latitude:b,longitude:c};if(g.events={},g.options={},null!=e.iconField&&null!=d.results[a].result.fields[e.iconField]?g.options.icon=f("actualValue")(d.results[a].result.fields[e.iconField].val):null!=e.icon&&(g.options.icon=e.icon),null!=e.labelField&&(g.infobox={},g.infobox.options={offset:new Microsoft.Maps.Point(0,25),width:125,height:50},g.infobox.title=null!=d.results[a].result.fields[e.labelField]?f("actualValue")(d.results[a].result.fields[e.labelField].val):"",g.infobox.visible=!1,g.events.mouseover=function(){g.infobox.visible=!0},g.events.mouseout=function(){g.infobox.visible=!1}),g.data={},null!=e.urlField){var h=null!=e.urlPrefix?e.urlPrefix:"";h+=null!=d.results[a].result.fields[e.urlField]?f("actualValue")(d.results[a].result.fields[e.urlField].val):"",g.data={url:h},g.events.click=function(a){var b=parseInt(a.target.pushpinData.index);window.open(k.markers[b].data.url,void 0!=e.target?e.target:"_blank")}}return g},addMarkers:function(a,b){for(var c=0;c<a.results.length;c++)if(a.results[c].result.fields[b.latitudeField]&&a.results[c].result.fields[b.longitudeField]){var d=f("actualValue")(a.results[c].result.fields[b.latitudeField].val),e=f("actualValue")(a.results[c].result.fields[b.longitudeField].val),g=D.createMarker(c,d,e,a,b);k.markers.push(g)}D.setMarkerIds(),D.setBounds(k.map)},setMarkerIds:function(){angular.forEach(k.markers,function(a,b){a.id=b,a.data.index=b})}},E={map:!1,points:[],graphics:[],modules:{},markerSymbol:!1,createMap:x,mapLoaded:y,geocodePoints:function(a,h){var i=g.gmapAddresses||{};k.loading=!0;var j=[];m.geocodeServerUrl=null==m.geocodeServerUrl?"http://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/":m.geocodeServerUrl;for(var l=0;l<a.results.length;l++){var n=void 0!=a.results[l].result.fields[h.addressField]?f("actualValue")(a.results[l].result.fields[h.addressField].val):"";null!=i&&null!=i[n]?j.push(null):null==n||""==n.trim()?j.push(null):j.push(b.get(m.geocodeServerUrl+"find?text="+n+"&f=pjson"))}c.all(j).then(function(b){angular.forEach(b,function(b,c){var d,j=void 0!=a.results[c].result.fields[h.addressField]?f("actualValue")(a.results[c].result.fields[h.addressField].val):"";if(null==b&&null!=i&&null!=i[j])d={y:i[j].lat,x:i[j].lng};else{if(null==b)return void e.warn("Unable to render result "+(c+1)+" - No Address to Render");if(0==b.data.locations.length)return void e.warn("Unable to get coordinates for result "+(c+1));d=b.data.locations[0].feature.geometry,i=g.gmapAddresses||{},i[j]={lat:d.y,lng:d.x},g.gmapAddresses=i}var l={};if(l.pointAttrs={},null!=m.urlField){var n=null!=m.urlPrefix?m.urlPrefix:"";n+=null!=a.results[c].result.fields[h.urlField]?f("actualValue")(a.results[c].result.fields[h.urlField].val):"",l.pointAttrs.url=n}l.label=" ";var o=null!=a.results[c].result.fields[h.labelField]?f("actualValue")(a.results[c].result.fields[h.labelField].val):"";null!=o&&""!=o&&(l.label=o),l.header=" ";var p=null!=a.results[c].result.fields[h.labelHeaderField]?f("actualValue")(a.results[c].result.fields[h.labelHeaderField].val):"";null!=p&&""!=p&&(l.header=p),l.symbol=E.createMarkerSymbol(h,a,c),l.point=new E.modules.Point(d.x,d.y),k.markers.push(l)})}).then(function(){E.makeEsriGraphics(),E.map.graphics.clear();for(var a=0;a<E.graphics.length;a++)E.map.graphics.add(E.graphics[a]);try{d(function(){E.fitBounds()},300)}catch(b){E.makeEsriGraphics(),E.map.graphics.clear();for(var a=0;a<E.graphics.length;a++)E.map.graphics.add(E.graphics[a]);E.fitBounds()}})},makeEsriPoints:function(a,b){for(var c=0;c<a.results.length;c++)if(a.results[c].result.fields[b.latitudeField]&&a.results[c].result.fields[b.longitudeField]){var d=f("actualValue")(a.results[c].result.fields[b.latitudeField].val),e=f("actualValue")(a.results[c].result.fields[b.longitudeField].val),g={};if(g.pointAttrs={},null!=m.urlField){var h=null!=m.urlPrefix?m.urlPrefix:"";h+=null!=a.results[c].result.fields[b.urlField]?f("actualValue")(a.results[c].result.fields[b.urlField].val):"",g.pointAttrs.url=h}g.label=" ";var i=null!=a.results[c].result.fields[b.labelField]?f("actualValue")(a.results[c].result.fields[b.labelField].val):"";null!=i&&""!=i&&(g.label=i),g.header=" ";var j=null!=a.results[c].result.fields[b.labelHeaderField]?f("actualValue")(a.results[c].result.fields[b.labelHeaderField].val):"";null!=j&&""!=j&&(g.header=j),g.symbol=E.createMarkerSymbol(b,a,c),g.point=new E.modules.Point(e,d),k.markers.push(g)}return k.markers},makeEsriGraphics:function(){E.graphics=[];for(var a=0;a<k.markers.length;a++)if(E.graphics.push(new E.modules.Graphic(k.markers[a].point,k.markers[a].symbol)),E.graphics[a].setAttributes(k.markers[a].pointAttrs)," "!=k.markers[a].label||" "!=k.markers[a].header){var b=new E.modules.InfoTemplate(k.markers[a].header,k.markers[a].label);E.graphics[a].setInfoTemplate(b)}return dojo.connect(E.map.graphics,"onClick",function(a){null!=a.graphic.attributes.url&&window.open(a.graphic.attributes.url)}),dojo.connect(E.map.graphics,"onMouseMove",function(a){var b=a.graphic;null!=b.getContent()&&(this._map.infoWindow.setContent(b.getContent()),this._map.infoWindow.setTitle(b.getTitle()),this._map.infoWindow.show(a.screenPoint,this._map.getInfoWindowAnchor(a.screenPoint)))}),dojo.connect(E.map.graphics,"onMouseOut",function(){this._map.infoWindow.hide()}),E.graphics},addEsriMarkers:function(a,b){E.makeEsriPoints(a,b),E.makeEsriGraphics(),E.map.graphics.clear();for(var c=0;c<E.graphics.length;c++)E.map.graphics.add(E.graphics[c]);E.fitBounds()},fitBounds:function(){try{var a=E.modules.GraphicUtils.graphicsExtent(E.graphics);E.map.setExtent(a,!0),k.loading=!1}catch(b){k.loading=!1}},createMarkerSymbol:function(a,b,c){return null!=a.iconField&&null!=b.results[c].result.fields[a.iconField]?new E.modules.PictureMarkerSymbol({angle:0,xoffset:0,yoffset:0,type:"esriPMS",url:f("actualValue")(b.results[c].result.fields[a.iconField].val),width:24,height:24}):null!=a.icon?new E.modules.PictureMarkerSymbol({angle:0,xoffset:0,yoffset:0,type:"esriPMS",url:a.icon,width:24,height:24}):new E.modules.PictureMarkerSymbol({angle:0,xoffset:0,yoffset:0,type:"esriPMS",imageData:"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",contentType:"image/png",width:24,height:24})}}}}}}angular.module("lightning").directive("geoMap",["$compile","$http","$q","$timeout","$log","$filter","$localStorage","esriLoader","uiGmapGoogleMapApi","$rootScope",a])}(),function(){"use strict";function a(a){var b={restrict:"E",transclude:!0,scope:{},require:"?^^geoMap",link:{post:function(b,c,d,e){d.response&&null!=e&&(b.response=a.getResponse(d.response),null!=b.response&&e.addLayer(b.response,d),b.$on(d.response+"_updated",function(a,c){b.response=c,e.addLayer(b.response,d)}))}}};return b}angular.module("lightning").directive("geoLayer",a),a.$inject=["ResponseService"]}(),function(){"use strict";function a(a,b){return{restrict:"E",scope:{response:"=",options:"=?"},transclude:!0,link:function(c,d,e){var f=!1;e.scrollToZoom="true"==e.scrollToZoom,a.then(function(){c.$watch("response",function(a){if(a){if(c.facet=c.response.facets[e.facetName],null==c.facet)return;if(f){if(null!=c.heatLayer){var d=[],g=new google.maps.LatLngBounds;angular.forEach(c.facet.filters,function(a){var c=b("actualValue")(a.val),e=c.split(","),f=e[0].trim(),h=e[1].trim();f=parseFloat(f),h=parseFloat(h);var i=new google.maps.LatLng(f,h);g.extend(i);var j={};j.location=i,j.weight=a.count,d.push(j)}),c.heatLayer.setData(d),c.googleBounds=g;var h=c.googlemap.getGMap();google.maps.event.trigger(h,"resize"),h.fitBounds(c.googleBounds)}}else c.mapOptions={scrollwheel:e.scrollToZoom},null!=c.options&&angular.extend(c.mapOptions,c.options),c.googlemap={},c.map={center:{latitude:38.9,longitude:-77.016},zoom:13,showHeat:!0,heatLayerCallback:function(a){var d=[],e=new google.maps.LatLngBounds;angular.forEach(c.facet.filters,function(a){var c=b("actualValue")(a.val),f=c.split(","),g=f[0].trim(),h=f[1].trim();g=parseFloat(g),h=parseFloat(h);var i=new google.maps.LatLng(g,h);e.extend(i);var j={};j.location=i,j.weight=a.count,d.push(j)}),a.setData(d),c.googleBounds=e;var g=c.googlemap.getGMap();google.maps.event.trigger(g,"resize"),g.fitBounds(c.googleBounds),f=!0,c.heatLayer=a}}}})})},template:function(a,b){var c=Math.floor(1e3*Math.random()+1);b.height=null==b.height?"400px":b.height,b.width=null==b.width?"100%":b.width;var d="<style>.map"+c+" .angular-google-map-container{height:"+b.height+"; width:"+b.width+';}</style><div class="map'+c+'" style="height:'+b.height+"; width:"+b.width+'; position:relative;" ng-if="response != null"><ui-gmap-google-map center="map.center" zoom="map.zoom" options="mapOptions" control="googlemap" ng-if="map != null"><ui-gmap-layer namespace="visualization" type="HeatmapLayer" show="map.showHeat" onCreated="map.heatLayerCallback"></ui-gmap-layer></ui-gmap-google-map></div>';return d}}}angular.module("lightning").directive("geoHeatmap",a),a.$inject=["uiGmapGoogleMapApi","$filter"]}(),function(){"use strict";function a(a,b,c){return{restrict:"E",scope:{response:"="},transclude:!0,link:function(d,e,f){function g(e){a.require(["esri/InfoTemplate","esri/layers/FeatureLayer","esri/map","esri/renderers/HeatmapRenderer","esri/tasks/FeatureSet","esri/geometry/Point","esri/symbols/SimpleMarkerSymbol","esri/Color","esri/graphic","esri/SpatialReference","esri/graphicsUtils"],function(a,g,i,j,k,l,m,n,o,p,q){d.esri={},d.$watch("response",function(a){if(a){if(d.facet=d.response.facets[f.facetName],null==d.facet)return;h?e.removeLayer(d.heatmapFeatureLayer):h=!0;var i,r,s,t=[],u=new k,v=new p(4326),w=(new m).setStyle(m.STYLE_SQUARE).setColor(new n([255,0,0,.5]));angular.forEach(d.facet.filters,function(a,b){var d=c("actualValue")(a.val),e=d.split(","),f=e[0].trim(),g=e[1].trim();f=parseFloat(f),g=parseFloat(g),i=new l(g,f,v),r={OBJECTID:b,weight:a.count,x:g,y:f},s=new o(i,w,r),t.push(s)}),u.features=t,u.geometryType="esriGeometryPoint";var x={objectIdField:"OBJECTID",layerDefinition:{geometryType:"esriGeometryPoint",fields:[{name:"OBJECTID",type:"esriFieldTypeOID"},{name:"weight",type:"esriFieldTypeDouble"},{name:"x",type:"esriFieldTypeDouble"},{name:"y",type:"esriFieldTypeDouble"}]},featureSet:u},y={mode:g.MODE_SNAPSHOT,outFields:["weight"]};d.heatmapFeatureLayer=new g(x,y);var z=new j({field:"weight"});d.heatmapFeatureLayer.setRenderer(z),e.addLayer(d.heatmapFeatureLayer),b(function(){var a=q.graphicsExtent(u.features);e.setExtent(a,!0)},0)}})})}var h=!1;d.loaded=!1,d.map={},f.javascriptApiUrl=null==f.javascriptApiUrl?"//js.arcgis.com/3.15compact":f.javascriptApiUrl,f.basemap=null==f.basemap?"topo":f.basemap,a.bootstrap({url:f.javascriptApiUrl}).then(function(){d.loaded=!0,d.map.options={basemap:f.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"}},function(){d.loaded=!0,f.basemap=null==f.basemap?"topo":f.basemap,d.map.options={basemap:f.basemap,center:[-122.676207,45.523452],zoom:13,sliderStyle:"small"}}),d.onMapLoad=g},template:function(a,b){var c=Math.floor(1e3*Math.random()+1);b.height=null==b.height?"400px":b.height,b.width=null==b.width?"100%":b.width;var d="<style>.map"+c+"{height:"+b.height+"; width:"+b.width+';}</style><div class="map'+c+'" style="height:'+b.height+"; width:"+b.width+'; position:relative;"><esri-map id="esrimap"style="height: 100%; width: 100%;" map-options="map.options" ng-if="loaded" load="onMapLoad"></esri-map></div>';return d}}}angular.module("lightning").directive("esriHeatmap",a),a.$inject=["esriLoader","$timeout","$filter"]}(),function(){"use strict";function a(){var a={restrict:"E",template:function(a,b){var c="";return"true"==b.toggleLayers&&(c+='<style>#layerListPane{width:200px !important;}</style><div id="layerListPane" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region:\'right\'"  style="position: absolute;right: 0px;z-index: 100;"><div id="layerList"></div></div>'),c}};return a}angular.module("lightning").directive("esriWebmap",a)}();