{
  "objects" : {
    "collections" : [ {
      "id" : "Finance_signals",
      "createdAt" : "2018-09-18T16:49:45.668Z",
      "searchClusterId" : "default",
      "commitWithin" : 10000,
      "solrParams" : {
        "name" : "Finance_signals",
        "numShards" : 2,
        "replicationFactor" : 1,
        "maxShardsPerNode" : 2,
        "configTemplate" : "solr/conf/insights.zip"
      },
      "type" : "DATA",
      "metadata" : { }
    }, {
      "id" : "Finance",
      "createdAt" : "2018-09-18T16:49:40.924Z",
      "searchClusterId" : "default",
      "commitWithin" : 10000,
      "solrParams" : {
        "name" : "Finance",
        "numShards" : 1,
        "replicationFactor" : 1
      },
      "type" : "DATA",
      "metadata" : { }
    }, {
      "id" : "Finance_signals_aggr",
      "createdAt" : "2018-09-18T16:49:49.872Z",
      "searchClusterId" : "default",
      "commitWithin" : 10000,
      "solrParams" : {
        "name" : "Finance_signals_aggr",
        "numShards" : 2,
        "replicationFactor" : 1,
        "maxShardsPerNode" : 2
      },
      "type" : "DATA",
      "metadata" : { }
    } ],
    "indexPipelines" : [ {
      "id" : "sp500",
      "stages" : [ {
        "type" : "javascript-index",
        "id" : "8si",
        "script" : "function(doc) {\n\n  if (doc !== null && doc.hasField('ticker')) {\n    var ticker = doc.getFirstFieldValue('ticker');\n    logger.info('Getting URL for ' + ticker);\n    if (ticker !== null) {\n    \n      var entityUtils = Packages.org.apache.http.util.EntityUtils;\n      var httpClient = org.apache.http.impl.client.HttpClients.createDefault();\n      var url = 'https://api.iextrading.com/1.0/stock/' + ticker + '/logo';\n      var httpGet = new org.apache.http.client.methods.HttpGet(url);\n\n      var response = entityUtils.toString(httpClient.execute(httpGet).getEntity());\n      var image_url_record = JSON.parse(response);\n\n      doc.addField('image_url_s', image_url_record.url);\n    }\n  }\n  // IEX doesn't like to be hit hard, sleep for a bit to throttle\n  java.lang.Thread.sleep(200);\n  return doc;\n}",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Add Logo URL",
        "licensed" : true,
        "secretSourceStageId" : "8si"
      }, {
        "type" : "javascript-index",
        "id" : "hen",
        "script" : "function(doc) {\n\n  if (doc !== null && doc.hasField('ticker')) {\n    var ticker = doc.getFirstFieldValue('ticker');\n    logger.info('Getting key stats for ' + ticker);\n    if (ticker !== null) {\n    \n      var entityUtils = Packages.org.apache.http.util.EntityUtils;\n      var httpClient = org.apache.http.impl.client.HttpClients.createDefault();\n      var url = 'https://api.iextrading.com/1.0/stock/' + ticker + '/stats';\n      var httpGet = new org.apache.http.client.methods.HttpGet(url);\n\n      var response = entityUtils.toString(httpClient.execute(httpGet).getEntity());\n      var stats_record = JSON.parse(response);\n\n      doc.addField('marketcap_f', stats_record.marketcap);\n      doc.addField('div_yield_f', stats_record.dividendYield);\n      doc.addField('eps_f', stats_record.latestEPS);\n      doc.addField('eps_date_dt', stats_record.latestEPSDate);\n      doc.addField('eps_fy1_f', stats_record.consensusEPS);\n      doc.addField('ebitda_f', stats_record.EBITDA);\n      doc.addField('revenue_f', stats_record.revenue);\n      doc.addField('price_to_book_f', stats_record.priceToBook);\n      doc.addField('beta_f', stats_record.beta);\n    }\n  }\n  // IEX doesn't like to be hit hard, sleep for a bit to throttle\n  java.lang.Thread.sleep(200);\n  return doc;\n}",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Add Key Stats",
        "licensed" : true,
        "secretSourceStageId" : "hen"
      }, {
        "type" : "field-mapping",
        "id" : "979c08de-b2c9-4347-9683-76b7be15316e",
        "mappings" : [ {
          "source" : "source_s",
          "target" : "Companies",
          "operation" : "set"
        } ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "979c08de-b2c9-4347-9683-76b7be15316e"
      }, {
        "type" : "solr-dynamic-field-name-mapping",
        "id" : "d5167606-5dd0-4c00-9131-1ad159a44f1a",
        "duplicateSingleValuedFields" : false,
        "fieldsToExclude" : [ ],
        "advancedTextFieldsIndexing" : true,
        "maxTextLengthForAdvancedIndexing" : 100,
        "type" : "solr-dynamic-field-name-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "d5167606-5dd0-4c00-9131-1ad159a44f1a"
      }, {
        "type" : "solr-index",
        "id" : "138ec69f-5a04-4909-9b9b-1cfaeea3e2f4",
        "enforceSchema" : true,
        "dateFormats" : [ ],
        "params" : [ ],
        "bufferDocsForSolr" : false,
        "type" : "solr-index",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "138ec69f-5a04-4909-9b9b-1cfaeea3e2f4"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "sp500"
      }
    }, {
      "id" : "Finance_signals",
      "stages" : [ {
        "type" : "field-mapping",
        "id" : "9c667736-6046-472c-b3cf-4ee729ed7a0c",
        "mappings" : [ ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "9c667736-6046-472c-b3cf-4ee729ed7a0c"
      }, {
        "type" : "solr-dynamic-field-name-mapping",
        "id" : "7fd90b14-b3bc-40b6-b3ca-64a4228fc293",
        "duplicateSingleValuedFields" : false,
        "fieldsToExclude" : [ ],
        "advancedTextFieldsIndexing" : true,
        "maxTextLengthForAdvancedIndexing" : 100,
        "type" : "solr-dynamic-field-name-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "7fd90b14-b3bc-40b6-b3ca-64a4228fc293"
      }, {
        "type" : "solr-index",
        "id" : "9bfeb2b6-556e-4517-811c-d8352c2fdfe0",
        "enforceSchema" : true,
        "dateFormats" : [ ],
        "params" : [ ],
        "bufferDocsForSolr" : false,
        "type" : "solr-index",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "9bfeb2b6-556e-4517-811c-d8352c2fdfe0"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "Finance_signals"
      }
    }, {
      "id" : "sp500-key-stats",
      "stages" : [ {
        "type" : "javascript-index",
        "id" : "g2j",
        "script" : "function(doc) {\n  var docs = [];\n\n  if (doc !== null && doc.hasField('ticker')) {\n    var ticker = doc.getFirstFieldValue('ticker');\n    logger.info('Getting key stats for ' + ticker);\n    if (ticker !== null) {\n    \n      var entityUtils = Packages.org.apache.http.util.EntityUtils;\n      var httpClient = org.apache.http.impl.client.HttpClients.createDefault();\n      var url = 'https://api.iextrading.com/1.0/stock/' + ticker + '/stats';\n      var httpGet = new org.apache.http.client.methods.HttpGet(url);\n\n      var response = entityUtils.toString(httpClient.execute(httpGet).getEntity());\n      var stats_record = JSON.parse(response);\n\n      // reliable ID for recrawl, e.g., to support data correct from IEX\n      var newDoc = new com.lucidworks.apollo.common.pipeline.PipelineDocument('key_stats_' + ticker);\n\n      newDoc.addField('_lw_data_source_s', doc.getFirstFieldValue('_lw_data_source_s'));\n      newDoc.addField('ticker', ticker);\n      newDoc.addField('marketcap_f', stats_record.marketcap);\n      newDoc.addField('div_yield_f', stats_record.dividendYield);\n      newDoc.addField('eps_f', stats_record.latestEPS);\n      newDoc.addField('eps_date_dt', stats_record.latestEPSDate);\n      newDoc.addField('eps_fy1_f', stats_record.consensusEPS);\n      newDoc.addField('ebitda_f', stats_record.EBITDA);\n      newDoc.addField('revenue_f', stats_record.revenue);\n      newDoc.addField('price_to_book_f', stats_record.priceToBook);\n      newDoc.addField('beta_f', stats_record.beta);\n      docs.push(newDoc);\n    }\n  }\n  // IEX doesn't like to be hit hard, sleep for a bit to throttle\n  java.lang.Thread.sleep(200);\n  return docs;\n}",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Get Key Stats",
        "licensed" : true,
        "secretSourceStageId" : "g2j"
      }, {
        "type" : "field-mapping",
        "id" : "50d8535e-b6bb-4753-9009-87d5a61b9d87",
        "mappings" : [ ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "50d8535e-b6bb-4753-9009-87d5a61b9d87"
      }, {
        "type" : "solr-dynamic-field-name-mapping",
        "id" : "ad5964bc-f418-43c2-8c22-b66229105306",
        "duplicateSingleValuedFields" : false,
        "fieldsToExclude" : [ ],
        "advancedTextFieldsIndexing" : true,
        "maxTextLengthForAdvancedIndexing" : 100,
        "type" : "solr-dynamic-field-name-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "ad5964bc-f418-43c2-8c22-b66229105306"
      }, {
        "type" : "solr-index",
        "id" : "ba0b3549-a9c9-4da3-8dc9-0b4d5221246c",
        "enforceSchema" : true,
        "dateFormats" : [ ],
        "params" : [ ],
        "bufferDocsForSolr" : false,
        "type" : "solr-index",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "ba0b3549-a9c9-4da3-8dc9-0b4d5221246c"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "sp500-key-stats"
      }
    }, {
      "id" : "Finance",
      "stages" : [ {
        "type" : "field-mapping",
        "id" : "f287f9ef-16c0-4579-b1b5-d3b06f5076f3",
        "mappings" : [ ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "f287f9ef-16c0-4579-b1b5-d3b06f5076f3"
      }, {
        "type" : "solr-dynamic-field-name-mapping",
        "id" : "46801769-18ef-4118-a42b-c3f8058c029a",
        "duplicateSingleValuedFields" : false,
        "fieldsToExclude" : [ ],
        "advancedTextFieldsIndexing" : true,
        "maxTextLengthForAdvancedIndexing" : 100,
        "type" : "solr-dynamic-field-name-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "46801769-18ef-4118-a42b-c3f8058c029a"
      }, {
        "type" : "solr-index",
        "id" : "019f493d-2cce-43d7-a274-ea3da4f8ef75",
        "enforceSchema" : true,
        "dateFormats" : [ ],
        "params" : [ ],
        "bufferDocsForSolr" : false,
        "type" : "solr-index",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "019f493d-2cce-43d7-a274-ea3da4f8ef75"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "Finance"
      }
    }, {
      "id" : "Finance_signals_aggr",
      "stages" : [ {
        "type" : "field-mapping",
        "id" : "8131c24e-0401-4253-a0fd-cbb5a4bdf646",
        "mappings" : [ ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "8131c24e-0401-4253-a0fd-cbb5a4bdf646"
      }, {
        "type" : "solr-dynamic-field-name-mapping",
        "id" : "0a306a19-4f15-4a47-829f-b9e7525efc44",
        "duplicateSingleValuedFields" : false,
        "fieldsToExclude" : [ ],
        "advancedTextFieldsIndexing" : true,
        "maxTextLengthForAdvancedIndexing" : 100,
        "type" : "solr-dynamic-field-name-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "0a306a19-4f15-4a47-829f-b9e7525efc44"
      }, {
        "type" : "solr-index",
        "id" : "8e965270-c889-4c7c-891e-79b9a2072565",
        "enforceSchema" : true,
        "dateFormats" : [ ],
        "params" : [ ],
        "bufferDocsForSolr" : false,
        "type" : "solr-index",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "8e965270-c889-4c7c-891e-79b9a2072565"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "Finance_signals_aggr"
      }
    }, {
      "id" : "sp500-historical",
      "stages" : [ {
        "type" : "javascript-index",
        "id" : "7zq",
        "script" : "function(doc) {\n  var docs = [];\n\n  if (doc !== null && doc.hasField('ticker')) {\n    var ticker = doc.getFirstFieldValue('ticker');\n    logger.info('Getting price history for ' + ticker);\n    if (ticker !== null) {\n    \n      var entityUtils = Packages.org.apache.http.util.EntityUtils;\n      var httpClient = org.apache.http.impl.client.HttpClients.createDefault();\n      var url = 'https://api.iextrading.com/1.0/stock/' + ticker + '/chart';\n      var httpGet = new org.apache.http.client.methods.HttpGet(url);\n\n      var response = entityUtils.toString(httpClient.execute(httpGet).getEntity());\n      var json_response = JSON.parse(response);\n      for (var i = 0; i < json_response.length; i++) {\n        var price_record = json_response[i];\n        \n        // reliable ID for recrawl, e.g., to support data correct from IEX\n        var newDoc = new com.lucidworks.apollo.common.pipeline.PipelineDocument('historical_price_' + ticker + '_' + price_record.date);\n        \n        newDoc.addField('_lw_data_source_s', doc.getFirstFieldValue('_lw_data_source_s'));\n        newDoc.addField('ticker', ticker);\n        newDoc.addField('date', price_record.date);\n        newDoc.addField('open', price_record.open);\n        newDoc.addField('high', price_record.high);\n        newDoc.addField('low', price_record.low);\n        newDoc.addField('close', price_record.close);\n        newDoc.addField('volume', price_record.volume);\n        newDoc.addField('unadjusted_volume', price_record.unadjustedVolume);\n        newDoc.addField('change', price_record.change);\n        newDoc.addField('change_percent', price_record.changePercent);\n        newDoc.addField('vwap', price_record.vwap);\n        docs.push(newDoc);\n      }\n    }\n  }\n  // IEX doesn't like to be hit hard, sleep for a bit to throttle\n  java.lang.Thread.sleep(200);\n  return docs;\n}",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Get Historical Prices",
        "licensed" : true,
        "secretSourceStageId" : "7zq"
      }, {
        "type" : "field-mapping",
        "id" : "13c12b85-c98f-4df5-a7b2-97d7e5f4e6fd",
        "mappings" : [ ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "13c12b85-c98f-4df5-a7b2-97d7e5f4e6fd"
      }, {
        "type" : "solr-dynamic-field-name-mapping",
        "id" : "69ac23f6-11d0-4e6c-a73c-ec4a56ef493c",
        "duplicateSingleValuedFields" : false,
        "fieldsToExclude" : [ ],
        "advancedTextFieldsIndexing" : true,
        "maxTextLengthForAdvancedIndexing" : 100,
        "type" : "solr-dynamic-field-name-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "69ac23f6-11d0-4e6c-a73c-ec4a56ef493c"
      }, {
        "type" : "solr-index",
        "id" : "8bcf7a20-b917-467e-a7e0-ed389c7c6bdd",
        "enforceSchema" : true,
        "dateFormats" : [ ],
        "params" : [ ],
        "bufferDocsForSolr" : false,
        "type" : "solr-index",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "8bcf7a20-b917-467e-a7e0-ed389c7c6bdd"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "sp500-historical"
      }
    }, {
      "id" : "yahoo-news",
      "stages" : [ {
        "type" : "field-mapping",
        "id" : "x8q",
        "mappings" : [ {
          "source" : "body",
          "target" : "body_s",
          "operation" : "copy"
        } ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "x8q"
      }, {
        "type" : "include-doc",
        "id" : "s7r",
        "matchRules" : [ {
          "field" : "id",
          "pattern" : ".*/news/.*"
        } ],
        "type" : "include-doc",
        "skip" : false,
        "label" : "Limit to News",
        "licensed" : true,
        "secretSourceStageId" : "s7r"
      }, {
        "type" : "javascript-index",
        "id" : "as",
        "script" : "function(doc) {\n    //varibale contating the original news item\\\n    if (doc.getId() !== null && doc.getFirstFieldValue(\"Content-Type\") != \"application/pdf\") {\n\n\n        logger.info(\"why is this not being run\");\n        var news_bodies = doc.getFieldValues('body');\n\n        // if no new body - do nothing\\\\\\\n        if (news_bodies == null || news_bodies.size() < 1) {\n            logger.info(\"this document had no content in the content field\");\n            return null;\n        }\n\n        var description = doc.getFirstFieldValue('title_txt');\n\n        var news_body = \"\";\n        for (i = 0; i < news_bodies.size(); i++) {\n            news_body = news_body.concat(news_bodies.get(i) + '\\\\n');\n        }\n\n\n        // news_body = news_body.split(\"\\n\").join(\" \");\n        //news_body1= news_body.replace(/GRPN/g, 'USA');\n        //  str = str.replace(\" \", \"_\");\n\n        var pattern = /\\n/g; // notice \"g\" here now!\n\n        news_body = news_body.replace(pattern, \" \");\n        //doc.addField('news_body_txt', news_body);\n\n        // Unique Identifier to connec tot calais\\\\\\\n        //var uniqueAccessKey='7KIwwT7p85yGM7Ag8h94YfXS5KNcbtur';\n        var uniqueAccessKey = '3e7c22df-a19d-44e3-a7cd-ee15256a700b';\n\n        // base url for open calais\\\\\\\n        //var CALAIS_URL = \"https://api.thomsonreuters.com/permid/calais\";\n        var CALAIS_URL = \"http://localhost:8080/tag/rs/enrich\";\n        // http://52.204.66.106:8080/\n        //post method\\\\\\\n        var method = new org.apache.commons.httpclient.methods.PostMethod(CALAIS_URL);\n\n        // Set mandatory parameters\\\\\\\n        method.setRequestHeader(\"X-AG-Access-Token\", uniqueAccessKey);\n        // Set input content type\\\\\\\n        method.setRequestHeader(\"Content-Type\", \"text/raw\");\n        // Set response/output format\\\\\\\n        method.setRequestHeader(\"outputformat\", \"application/json\");\n\n        method.setRequestBody(news_body);\n\n        var client = new org.apache.commons.httpclient.HttpClient;\n\n        var returnCode = client.executeMethod(method);\n\n        var responseValue = \"\";\n\n      logger.warn(\"FOOOOO Return code is :\" + returnCode);\n        if (returnCode == org.apache.commons.httpclient.HttpStatus.SC_NOT_IMPLEMENTED) {\n          //  Do Something to capture response code\\\\\\\n          logger.warn(\"this is not working\");\n          doc.addField('version', 'untagged');\n        } else if (returnCode == org.apache.commons.httpclient.HttpStatus.SC_OK) {\n          responseValue = method.getResponseBodyAsString();\n       \t  doc.addField('version', 'v1');\n        } else {\n            //  Do Something to capture response code\\\\\\\n        \tlogger.warn(\"this is not working\");\n        \tdoc.addField('version', 'untagged');\n        }\n\n        // remove single new bodies fields to sum them up in one \\\\\\\n        //doc.removeFields('news_body');\n        // doc.addField('news_body', news_body);\n\n        doc.addField('returnCode', returnCode);\n        doc.addField('responseValue', responseValue);\n\n    }\n    return doc;\n}\n",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Entity Extraction: API call",
        "licensed" : true,
        "secretSourceStageId" : "as"
      }, {
        "type" : "javascript-index",
        "id" : "xym",
        "script" : "function(doc) {\n\n    var responseValue = doc.getFieldValues('responseValue');\n\n    var obj;\n    try {\n        obj = JSON.parse(responseValue);\n    } catch (err) {\n        doc.setField(\"version\", \"untagged\");\n        return doc;\n    }\n\n\n    if (obj == null || (typeof obj == 'undefined') || (typeof obj[0] == 'undefined'))\n        return doc;\n\n    // array to store the name of companies\\\n    var companies = [];\n    // array to store the name of thier respective permids\\\n    var comp_permids = \"\";\n\n    // Get all the Key in the response\\\n    var allKeys = Object.keys(obj[0]);\n\n    // doc.addField('Field Val', Object.keys(obj[0]));\\\n\n    if (allKeys != null) {\n\n        for (i = 0; i < allKeys.length; ++i) {\n\n            tag = obj[0][allKeys[i]]._typeGroup;\n            type = obj[0][allKeys[i]]._type;\n            ////////////////////////////\n            //Social Tags\n            ////////////////////////////\n\n            if (tag != null && tag.equals(\"socialTag\") && obj[0][allKeys[i]].forenduserdisplay.equals(\"true\")) {\n                if (obj[0][allKeys[i]].forenduserdisplay.equals(\"true\"))\n                    doc.addField('social_tags_ss', obj[0][allKeys[i]].name);\n                // doc.addField('entity_all_lv_s', obj[0][allKeys[i]].name);\n                if (obj[0][allKeys[i]].importance == 1) {\n                    doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].name);\n                    doc.addField('social_tags_hv_ss', obj[0][allKeys[i]].name);\n\n                } else if (obj[0][allKeys[i]].importance == 2) {\n                    doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].name);\n                    doc.addField('social_tags_mv_ss', obj[0][allKeys[i]].name);\n                } else if (obj[0][allKeys[i]].importance == 3) {\n                    doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].name);\n                    doc.addField('social_tags_lv_ss', obj[0][allKeys[i]].name);\n                }\n            }\n\n\n\n            ////////////////////////////\n            //Extract Entity Types\n            ////////////////////////////\n            if (type != null && tag != null && tag.equals(\"entities\")) {\n\n                if (type.equals(\"Company\")) {\n                    var companyScore = parseFloat(obj[0][allKeys[i]].confidencelevel) * parseFloat(obj[0][allKeys[i]].relevance);\n                    //  var companyScore = 0.5;\n                    doc.addField('entity_company_ss', obj[0][allKeys[i]].name);\n                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].name + '|' + companyScore);\n                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].name + '|' + companyScore);\n\n\n                    // logger.info(\"company has been added \" + obj[0][allKeys[i]].name + \" with a relevance score of \" + obj[0][allKeys[i]].relevance);\n                    if ((parseFloat(obj[0][allKeys[i]].confidencelevel) * parseFloat(obj[0][allKeys[i]].relevance) >= .6)) {\n                        // doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].name);\n                        // doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].name);\n\n\n                        if (obj[0][allKeys[i]].resolutions === null) {\n                            doc.addField('entity_company_markup_hv_ss', obj[0][allKeys[i]].name);\n                            doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].name);\n\n                        }\n                        // if the resolution isn't ana array\n                        if (obj[0][allKeys[i]].resolutions != null) {\n                            // doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].name);\n                            // doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].name);\n\n\n\n\n                            if (!Array.isArray(obj[0][allKeys[i]].resolutions[0].primaryric)) {\n\n                              doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].resolutions[0].name);\n                              doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].resolutions[0].name);\n\n                              doc.addField('entity_company_numbers_hv_txt', obj[0][allKeys[i]].resolutions[0].name + \" conf: \" + obj[0][allKeys[i]].confidencelevel + \" rel: \" + obj[0][allKeys[i]].relevance + \" count: \" + obj[0][allKeys[i]].instances.length + \" score: \" + obj[0][allKeys[i]].resolutions[0].score);\n\n\n                                if (obj[0][allKeys[i]].resolutions[0].primaryric != null) {\n                                    // doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].resolutions[0].primaryric);\n\n                                  \n                                    doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].resolutions[0].primaryric);\n                                    doc.addField('entity_stock_ticker_hv_ss', obj[0][allKeys[i]].resolutions[0].primaryric);\n                                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].primaryric + '|' + companyScore);\n                                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].primaryric + '|' + companyScore);\n\n                                }\n                                // doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].resolutions[0].permid);\n                                doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].resolutions[0].permid);\n\n                                doc.addField('entity_permid_hv_ss', obj[0][allKeys[i]].resolutions[0].permid);\n\n                                doc.addField('entity_all_payloads', obj[0][allKeys[i]].permid + '|' + companyScore);\n                                doc.addField('entity_company_payloads', obj[0][allKeys[i]].permid + '|' + companyScore);\n\n                                if (obj[0][allKeys[i]].resolutions[0].commonname != null) {\n                                    // doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].resolutions[0].commonname);\n                                    doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].resolutions[0].commonname);\n                                    doc.addField('entity_company_commonname_hv_ss', obj[0][allKeys[i]].resolutions[0].commonname);\n\n\n                                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].commonname + '|' + companyScore);\n                                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].commonname + '|' + companyScore);\n\n                                }\n                            } else {\n                                for (ff = 0; ff < obj[0][allKeys[i]].resolutions[0].primaryric.length; ++ff) {\n                                  // doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].resolutions[0].primaryric[ff]);\n                                  doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].resolutions[0].name[ff]);\n                                  doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].resolutions[0].name[ff]);\n\n                                  doc.addField('entity_company_numbers_hv_txt', obj[0][allKeys[i]].resolutions[0].name[ff] + \" conf: \" + obj[0][allKeys[i]].confidencelevel + \" rel: \" + obj[0][allKeys[i]].relevance + \" count: \" + obj[0][allKeys[i]].instances.length + \" score: \" + obj[0][allKeys[i]].resolutions[0].score[ff]);\n\n\n                                    if (obj[0][allKeys[i]].resolutions[0].primaryric[ff] != null) {\n                                    \n                                        doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].resolutions[0].primaryric[ff]);\n                                        doc.addField('entity_stock_ticker_hv_ss', obj[0][allKeys[i]].resolutions[0].primaryric[ff]);\n\n                                        doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].primaryric[ff] + '|' + companyScore);\n                                        doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].primaryric[ff] + '|' + companyScore);\n\n                                    }\n                                    // doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].resolutions[0].permid[ff]);\n                                    doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].resolutions[0].permid[ff]);\n\n                                    doc.addField('entity_permid_hv_ss', obj[0][allKeys[i]].resolutions[0].permid[ff]);\n\n                                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].permid[ff] + '|' + companyScore);\n                                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].permid[ff] + '|' + companyScore);\n\n                                    if (obj[0][allKeys[i]].resolutions[0].commonname != null) {\n                                        doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].resolutions[0].commonname[ff]);\n                                        // doc.addField('entity_company_hv_ss', obj[0][allKeys[i]].resolutions[0].commonname[ff]);\n                                        doc.addField('entity_company_commonname_hv_ss', obj[0][allKeys[i]].resolutions[0].commonname[ff]);\n                                        doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].commonname[ff] + '|' + companyScore);\n                                        doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].commonname[ff] + '|' + companyScore);\n\n\n                                    }\n                                }\n                            }\n                        }\n\n                    } else if (parseFloat(obj[0][allKeys[i]].confidencelevel) * parseFloat(obj[0][allKeys[i]].relevance) >= .4) {\n\n\n                        if (obj[0][allKeys[i]].resolutions === null) {\n                            doc.addField('entity_company_markup_mv_ss', obj[0][allKeys[i]].name);\n                            doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].name);\n\n                        }\n\n\n                        if (obj[0][allKeys[i]].resolutions != null) {\n                            if (!Array.isArray(obj[0][allKeys[i]].resolutions[0].primaryric)) {\n\n                              doc.addField('entity_company_mv_ss', obj[0][allKeys[i]].resolutions[0].name);\n                              doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].resolutions[0].name);\n                              // doc.addField('entity_company_mv_ss', obj[0][allKeys[i]].resolutions[0].primaryric);\n\n                              doc.addField('entity_company_numbers_mv_txt', obj[0][allKeys[i]].resolutions[0].name + \" conf: \" + obj[0][allKeys[i]].confidencelevel + \" rel: \" + obj[0][allKeys[i]].relevance + \" count: \" + obj[0][allKeys[i]].instances.length + \" score: \" + obj[0][allKeys[i]].resolutions[0].score);\n\n\n                              \n                                if (obj[0][allKeys[i]].resolutions[0].primaryric != null) {\n\n                                  \n                                    doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].resolutions[0].primaryric);\n\n                                    doc.addField('entity_stock_ticker_mv_ss', obj[0][allKeys[i]].resolutions[0].primaryric);\n\n\n                                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].primaryric + '|' + companyScore);\n                                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].primaryric + '|' + companyScore);\n\n                                }\n                                // doc.addField('entity_company_mv_ss', obj[0][allKeys[i]].resolutions[0].permid);\n                                doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].resolutions[0].permid);\n\n                                doc.addField('entity_permid_mv_ss', obj[0][allKeys[i]].resolutions[0].permid);\n\n\n                                doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].permid + '|' + companyScore);\n                                doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].permid + '|' + companyScore);\n\n                                if (obj[0][allKeys[i]].resolutions[0].commonname != null) {\n                                    // doc.addField('entity_company_mv_ss', obj[0][allKeys[i]].resolutions[0].commonname);\n                                    doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].resolutions[0].commonname);\n                                    doc.addField('entity_company_commonname_mv_ss', obj[0][allKeys[i]].resolutions[0].commonname);\n                                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].commonname + '|' + companyScore);\n                                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].commonname + '|' + companyScore);\n                                }\n                            } else {\n                                for (ff = 0; ff < obj[0][allKeys[i]].resolutions[0].primaryric.length; ++ff) {\n                                    if (obj[0][allKeys[i]].resolutions[0].primaryric[ff] != null) {\n                                        doc.addField('entity_company_mv_ss', obj[0][allKeys[i]].resolutions[0].name[ff]);\n                                        doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].resolutions[0].name[ff]);\n                                        // doc.addField('entity_company_mv_ss', obj[0][allKeys[i]].resolutions[0].primaryric[ff]);\n\n                                        doc.addField('entity_company_numbers_mv_txt', obj[0][allKeys[i]].resolutions[0].name[ff] + \" conf: \" + obj[0][allKeys[i]].confidencelevel + \" rel: \" + obj[0][allKeys[i]].relevance + \" count: \" + obj[0][allKeys[i]].instances.length + \" score: \" + obj[0][allKeys[i]].resolutions[0].score[ff]);\n\n                                        doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].resolutions[0].primaryric[ff]);\n\n                                        doc.addField('entity_stock_ticker_mv_ss', obj[0][allKeys[i]].resolutions[0].primaryric[ff]);\n\n                                        doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].primaryric[ff] + '|' + companyScore);\n                                        doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].primaryric[ff] + '|' + companyScore);\n                                    }\n                                    // doc.addField('entity_company_mv_ss', obj[0][allKeys[i]].resolutions[0].permid[ff]);\n                                    doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].resolutions[0].permid[ff]);\n\n                                    doc.addField('entity_permid_mv_ss', obj[0][allKeys[i]].resolutions[0].permid[ff]);\n\n                                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].permid[ff] + '|' + companyScore);\n                                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].permid[ff] + '|' + companyScore);\n\n                                    if (obj[0][allKeys[i]].resolutions[0].commonname != null) {\n                                        // doc.addField('entity_company_mv_ss', obj[0][allKeys[i]].resolutions[0].commonname[ff]);\n                                        doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].resolutions[0].commonname[ff]);\n\n                                        doc.addField('entity_company_commonname_mv_ss', obj[0][allKeys[i]].resolutions[0].commonname[ff]);\n\n                                        doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].commonname[ff] + '|' + companyScore);\n                                        doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].commonname[ff] + '|' + companyScore);\n\n\n                                    }\n                                }\n                            }\n                        }\n                    } else {\n                        //  doc.addField('entity_company_lv_ss', obj[0][allKeys[i]].name);\n\n                        if (obj[0][allKeys[i]].resolutions === null) {\n                            doc.addField('entity_company_markup_lv_ss', obj[0][allKeys[i]].name);\n                            doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].name);\n\n                        }\n\n                        if (obj[0][allKeys[i]].resolutions != null) {\n\n                            if (!Array.isArray(obj[0][allKeys[i]].resolutions[0].primaryric)) {\n\n                              doc.addField('entity_company_lv_ss', obj[0][allKeys[i]].resolutions[0].name);\n                              doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].resolutions[0].name);\n                              // doc.addField('entity_company_lv_ss', obj[0][allKeys[i]].resolutions[0].primaryric);\n\n                              doc.addField('entity_company_numbers_lv_txt', obj[0][allKeys[i]].resolutions[0].name + \" conf: \" + obj[0][allKeys[i]].confidencelevel + \" rel: \" + obj[0][allKeys[i]].relevance + \" count: \" + obj[0][allKeys[i]].instances.length + \" score: \" + obj[0][allKeys[i]].resolutions[0].score);\n\n\n                                if (obj[0][allKeys[i]].resolutions[0].primaryric != null) {\n                                  \n                                    doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].resolutions[0].primaryric);\n\n                                    doc.addField('entity_stock_ticker_lv_ss', obj[0][allKeys[i]].resolutions[0].primaryric);\n\n                                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].primaryric + '|' + companyScore);\n                                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].primaryric + '|' + companyScore);\n                                }\n                                // doc.addField('entity_company_lv_ss', obj[0][allKeys[i]].resolutions[0].permid);\n                                doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].resolutions[0].permid);\n\n                                doc.addField('entity_permid_lv_ss', obj[0][allKeys[i]].resolutions[0].permid);\n\n                                doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].permid + '|' + companyScore);\n                                doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].permid + '|' + companyScore);\n\n                                if (obj[0][allKeys[i]].resolutions[0].commonname != null) {\n                                    // doc.addField('entity_company_lv_ss', obj[0][allKeys[i]].resolutions[0].commonname);\n                                    doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].resolutions[0].commonname);\n\n                                    doc.addField('entity_permid_lv_ss', obj[0][allKeys[i]].resolutions[0].commonname);\n\n\n                                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].commonname + '|' + companyScore);\n                                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].commonname + '|' + companyScore);\n                                }\n                            } else {\n                                for (ff = 0; ff < obj[0][allKeys[i]].resolutions[0].primaryric.length; ++ff) {\n\n                                  doc.addField('entity_company_lv_ss', obj[0][allKeys[i]].resolutions[0].name[ff]);\n                                  doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].resolutions[0].name[ff]);\n\n                                  doc.addField('entity_company_numbers_lv_txt', obj[0][allKeys[i]].resolutions[0].name[ff] + \" conf: \" + obj[0][allKeys[i]].confidencelevel + \" rel: \" + obj[0][allKeys[i]].relevance + \" count: \" + obj[0][allKeys[i]].instances.length + \" score: \" + obj[0][allKeys[i]].resolutions[0].score[ff]);\n\n\n                                    if (obj[0][allKeys[i]].resolutions[0].primaryric[ff] != null) {\n                                        // doc.addField('entity_company_lv_ss', obj[0][allKeys[i]].resolutions[0].primaryric[ff]);\n                                      \n                                        doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].resolutions[0].primaryric[ff]);\n\n                                        doc.addField('entity_stock_ticker_lv_ss', obj[0][allKeys[i]].resolutions[0].primaryric[ff]);\n\n                                        doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].primaryric[ff] + '|' + companyScore);\n                                        doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].primaryric[ff] + '|' + companyScore);\n\n                                    }\n                                    // doc.addField('entity_company_lv_ss', obj[0][allKeys[i]].resolutions[0].permid[ff]);\n                                    doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].resolutions[0].permid[ff]);\n\n                                    doc.addField('entity_permid_lv_ss', obj[0][allKeys[i]].resolutions[0].permid[ff]);\n\n\n                                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].permid[ff] + '|' + companyScore);\n                                    doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].permid[ff] + '|' + companyScore);\n\n                                    if (obj[0][allKeys[i]].resolutions[0].commonname != null) {\n                                        // doc.addField('entity_company_lv_ss', obj[0][allKeys[i]].resolutions[0].commonname[ff]);\n                                        doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].resolutions[0].commonname[ff]);\n\n                                        doc.addField('entity_company_commonname_lv_ss', obj[0][allKeys[i]].resolutions[0].commonname[ff]);\n\n\n                                        doc.addField('entity_all_payloads', obj[0][allKeys[i]].resolutions[0].commonname[ff] + '|' + companyScore);\n                                        doc.addField('entity_company_payloads', obj[0][allKeys[i]].resolutions[0].commonname[ff] + '|' + companyScore);\n                                    }\n                                }\n                            }\n                            //still need to do this one this needs to be built out\n\n                        }\n                    }\n\n                } else if (type.equals(\"Country\")) {\n                    doc.addField('entity_country_ss', obj[0][allKeys[i]].name);\n                    //doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].name);\n\n                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].name + '|' + obj[0][allKeys[i]].relevance);\n\n                    if (obj[0][allKeys[i]].relevance <= .2) {\n                        doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].name);\n\n\n                        doc.addField('entity_country_lv_ss', obj[0][allKeys[i]].name);\n                    } else if (obj[0][allKeys[i]].relevance < .2 && obj[0][allKeys[i]].relevance > .8) {\n                        doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].name);\n                        doc.addField('entity_country_mv_ss', obj[0][allKeys[i]].name);\n                    } else if (obj[0][allKeys[i]].relevance >= .8) {\n                        doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].name);\n                        doc.addField('entity_country_hv_ss', obj[0][allKeys[i]].name);\n                    }\n                } else if (type.equals(\"Person\") || type.equals(\"Editor\") || type.equals(\"Journalist\")) {\n                    //  doc.addField('entity_person_ss', obj[0][allKeys[i]].name);\n\n                    doc.addField('entity_all_payloads', obj[0][allKeys[i]].name + '|' + obj[0][allKeys[i]].relevance);\n\n                    if (obj[0][allKeys[i]].relevance <= .2) {\n                        doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].name);\n                        doc.addField('entity_person_lv_ss', obj[0][allKeys[i]].name);\n                    } else if (obj[0][allKeys[i]].relevance < .2 && obj[0][allKeys[i]].relevance > .8) {\n                        doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].name);\n                        doc.addField('entity_person_mv_ss', obj[0][allKeys[i]].name);\n                    } else if (obj[0][allKeys[i]].relevance >= .8) {\n                        doc.addField('entity_person_hv_ss', obj[0][allKeys[i]].name);\n                        doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].name);\n                    }\n                }\n            }\n        }\n    }\n\n    return doc;\n}\n",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Entity Extraction: Parse Entities",
        "licensed" : true,
        "secretSourceStageId" : "xym"
      }, {
        "type" : "javascript-index",
        "id" : "kb",
        "script" : "function(doc) {\n\n    var responseValue = doc.getFieldValues('responseValue');\n\n   var obj;\n    try {\n      obj = JSON.parse(responseValue);\n    } catch(err) {\n      doc.setField(\"version\", \"untagged\");\n      return doc;\n    }\n\n    if (obj == null || (typeof obj == 'undefined') || (typeof obj[0] == 'undefined'))\n        return doc;\n\n    // array to store the name of companies\\\n    var companies = [];\n    // array to store the name of thier respective permids\\\n    var comp_permids = \"\";\n\n    // Get all the Key in the response\\\n    var allKeys = Object.keys(obj[0]);\n\n    // doc.addField('Field Val', Object.keys(obj[0]));\\\n\n    if (allKeys != null) {\n\n        for (i = 0; i < allKeys.length; ++i) {\n\n            tag = obj[0][allKeys[i]]._typeGroup;\n            type = obj[0][allKeys[i]]._type;\n            //logger.warn('test1234');\n            //if social tags\\\n\n            ////////////////////////////\n            //Extract Entity Types\n            ////////////////////////////\n\n            if (type != null && tag != null && tag.equals(\"relations\")) {\n                //Reject -, , , , , CompanyAffiliates, ,,,,,,, , ,, ,,, , , CompanyTicker,, , , , ,,, , ,,, , , , , , FDAPhase, , ,,, ,, , , , ,,, , , , , , , , , , , , ,,,, Quotation, ,,\n                if (!obj[0][allKeys[i]]._type.equals(\"Quotation\") && !obj[0][allKeys[i]]._type.equals(\"Company Affiliates\") && !obj[0][allKeys[i]]._type.equals(\"CompanyTicker\") && !obj[0][allKeys[i]]._type.equals(\"CompanyLocation\") && !obj[0][allKeys[i]]._type.equals(\"FDAPhase\") && !obj[0][allKeys[i]]._type.equals(\"PersonCareer\") && !obj[0][allKeys[i]]._type.equals(\"CompanyTicker\") && !obj[0][allKeys[i]]._type.equals(\"ArmedAttack\") && !obj[0][allKeys[i]]._type.equals(\"ArmsPurchaseSale\") && !obj[0][allKeys[i]]._type.equals(\"Arrest\") && !obj[0][allKeys[i]]._type.equals(\"CandidatePosition\") && !obj[0][allKeys[i]]._type.equals(\"CompanyAccountingChange\") && !obj[0][allKeys[i]]._type.equals(\"CompanyEmployeesNumber\") && !obj[0][allKeys[i]]._type.equals(\"CompanyListingChange\") && !obj[0][allKeys[i]]._type.equals(\"CompanyFounded\") && !obj[0][allKeys[i]]._type.equals(\"CompanyFounded\") && !obj[0][allKeys[i]]._type.equals(\"CompanyLocation\") && !obj[0][allKeys[i]]._type.equals(\"CompanyRestatement\") && !obj[0][allKeys[i]]._type.equals(\"CompanyTechnology\") && !obj[0][allKeys[i]]._type.equals(\"ContactDetails\") && !obj[0][allKeys[i]]._type.equals(\"Conviction\") && !obj[0][allKeys[i]]._type.equals(\"CreditRating\") && !obj[0][allKeys[i]]._type.equals(\"DelayedFiling\") && !obj[0][allKeys[i]]._type.equals(\"DiplomaticRelations\") && !obj[0][allKeys[i]]._type.equals(\"EmploymentRelation\") && !obj[0][allKeys[i]]._type.equals(\"EnvironmentalIssue\") && !obj[0][allKeys[i]]._type.equals(\"Extinction\") && !obj[0][allKeys[i]]._type.equals(\"FamilyRelation\") && !obj[0][allKeys[i]]._type.equals(\"IndicesChanges\") && !obj[0][allKeys[i]]._type.equals(\"Indictment\") && !obj[0][allKeys[i]]._type.equals(\"ManMadeDisaster\") && !obj[0][allKeys[i]]._type.equals(\"MilitaryAction\") && !obj[0][allKeys[i]]._type.equals(\"MovieRelease\") && !obj[0][allKeys[i]]._type.equals(\"MusicAlbumRelease\") && !obj[0][allKeys[i]]._type.equals(\"NaturalDisaster\") && !obj[0][allKeys[i]]._type.equals(\"PersonAttributes\") && !obj[0][allKeys[i]]._type.equals(\"PersonCareer\") && !obj[0][allKeys[i]]._type.equals(\"PersonCommunication\") && !obj[0][allKeys[i]]._type.equals(\"PersonEducation\") && !obj[0][allKeys[i]]._type.equals(\"PersonEmailAddress\") && !obj[0][allKeys[i]]._type.equals(\"PersonLocation\") && !obj[0][allKeys[i]]._type.equals(\"PersonParty\") && !obj[0][allKeys[i]]._type.equals(\"PersonRelation\") && !obj[0][allKeys[i]]._type.equals(\"PersonTravel\") && !obj[0][allKeys[i]]._type.equals(\"PoliticalEndorsement\") && !obj[0][allKeys[i]]._type.equals(\"PoliticalRelationship\") && !obj[0][allKeys[i]]._type.equals(\"PollsResult\") && !obj[0][allKeys[i]]._type.equals(\"SecondaryIssuance\") && !obj[0][allKeys[i]]._type.equals(\"Trial\") && !obj[0][allKeys[i]]._type.equals(\"VotingResult\")) {\n                    doc.addField('relation_event_ss', obj[0][allKeys[i]]._type);\n                    var ref = \"\"\n                    var ref1 = \"\"\n                    var double_take = false;\n                    ref = obj[0][allKeys[i]].company\n                    if ((typeof ref == 'undefined'))\n                        ref = obj[0][allKeys[i]].company_rated\n                    if ((typeof ref == 'undefined'))\n                        ref = obj[0][allKeys[i]].acquirer\n                    if ((typeof ref == 'undefined'))\n                        ref = obj[0][allKeys[i]].company_investigated\n                    if ((typeof ref == 'undefined')) {\n                        ref = obj[0][allKeys[i]].company_acquirer\n                        if (obj[0][allKeys[i]].company_beingacquired != null) {\n                            ref1 = obj[0][allKeys[i]].company_beingacquired\n                            double_take = true;\n                        }\n                    }\n\n                    if (ref != null && obj[0][ref] != null) {\n                        // doc.addField('entity_first_ss', Array.isArray(ref))\n                        if (Array.isArray(ref) == true) {\n                            for (k = 0; k < ref.length; ++k) {\n                                doc.addField('Company_Events_ss', obj[0][ref[k]].name + \" \" + obj[0][allKeys[i]]._type);\n                                doc.addField('company_events_payloads', obj[0][allKeys[i]].name + '|' + obj[0][allKeys[i]].relevance);\n                                doc.addField('entity_all_payloads', obj[0][allKeys[i]].name + '|' + obj[0][allKeys[i]].relevance);\n\n                                var refKScores = parseFloat(obj[0][ref[k]].confidencelevel) * parseFloat(obj[0][ref[k]].relevance);\n\n                                if ((parseFloat(obj[0][ref[k]].confidencelevel) * parseFloat(obj[0][ref[k]].relevance) >= .6)) {\n\n                                    doc.addField('entity_all_hv_ss', obj[0][ref[k]].name + \" \" + obj[0][allKeys[i]]._type);\n                                    // if the company can be resolved add its url,and perm id for the typeahead and confidance ranking\n                                    if (obj[0][ref[k]].resolutions != null) {\n                                        doc.addField('event_support_ss', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                        doc.addField('event_support_ss', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n                                        doc.addField('entity_all_hv_ss', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                        doc.addField('entity_all_hv_ss', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n\n                                        // doc.addField('event_support_payloads', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type + '|' + obj[0][ref[k]].relevance);\n                                        // doc.addField('event_support_payloads', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type + '|' + obj[0][ref[k]].relevance);\n                                        doc.addField('entity_all_payloads', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type + '|' + refKScores);\n                                        doc.addField('entity_all_payloads', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type + '|' + refKScores);\n                                    }\n\n                                } else if ((parseFloat(obj[0][ref[k]].confidencelevel) * parseFloat(obj[0][ref[k]].relevance) >= .4)) {\n                                    doc.addField('entity_all_mv_ss', obj[0][ref[k]].name + \" \" + obj[0][allKeys[i]]._type);\n                                    if (obj[0][ref[k]].resolutions != null) {\n                                        doc.addField('event_support_ss', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                        doc.addField('event_support_ss', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n                                        doc.addField('entity_all_mv_ss', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                        doc.addField('entity_all_mv_ss', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n\n\n                                        // doc.addField('event_support_payloads', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type + '|' + obj[0][ref[k]].relevance);\n                                        // doc.addField('event_support_payloads', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type + '|' + obj[0][ref[k]].relevance);\n                                        doc.addField('entity_all_payloads', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type + '|' + refKScores);\n                                        doc.addField('entity_all_payloads', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type + '|' + refKScores);\n\n                                    }\n\n                                } else {\n                                    doc.addField('entity_all_lv_ss', obj[0][ref[k]].name + \" \" + obj[0][allKeys[i]]._type);\n                                    if (obj[0][ref[k]].resolutions != null) {\n                                        doc.addField('event_support_ss', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                        doc.addField('event_support_ss', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n                                        doc.addField('entity_all_lv_ss', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                        doc.addField('entity_all_lv_ss', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n\n                                        // doc.addField('event_support_payloads', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type + '|' + obj[0][ref[k]].relevance);\n                                        // doc.addField('event_support_payloads', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type + '|' + obj[0][ref[k]].relevance);\n                                        doc.addField('entity_all_payloads', obj[0][ref[k]].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type + '|' + refKScores);\n                                        doc.addField('entity_all_payloads', obj[0][ref[k]].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type + '|' + refKScores);\n\n                                    }\n                                }\n                            }\n\n\n                        } else {\n\n\n                            doc.addField('Company_Events_ss', obj[0][ref].name + \" \" + obj[0][allKeys[i]]._type);\n                            doc.addField('event_support_ss', obj[0][ref].name + \" \" + obj[0][allKeys[i]]._type);\n                            var refScore = parseFloat(obj[0][ref].confidencelevel) * parseFloat(obj[0][ref].relevance);\n\n                            if ((parseFloat(obj[0][ref].confidencelevel) * parseFloat(obj[0][ref].relevance) >= .6)) {\n                                doc.addField('entity_all_hv_ss', obj[0][ref].name + \" \" + obj[0][allKeys[i]]._type);\n                                doc.addField('entity_all_payloads', obj[0][ref].name + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n\n                                if (double_take) {\n                                    // add the company even if the display is off\n                                    //      doc.addField('entity_company_ss', obj[0][ref1].name);\n                                    //  doc.addField('entity_first1_ss', ref1 +\" _ \"+obj[0][allKeys[i]]._type );\n                                    doc.addField('Company_Events_ss', obj[0][ref1].name + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('entity_all_hv_ss', obj[0][ref1].name + \" \" + obj[0][allKeys[i]]._type);\n\n                                    doc.addField('entity_all_payloads', obj[0][ref1].name + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n\n                                }\n                                if (obj[0][ref].resolutions != null) {\n                                    doc.addField('event_support_ss', obj[0][ref].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('event_support_ss', obj[0][ref].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('entity_all_hv_ss', obj[0][ref].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('entity_all_hv_ss', obj[0][ref].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n\n                                    doc.addField('entity_all_payloads', obj[0][ref].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n                                    doc.addField('entity_all_payloads', obj[0][ref].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n\n                                }\n                            } else if ((parseFloat(obj[0][ref].confidencelevel) * parseFloat(obj[0][ref].relevance) >= .4)) {\n                                doc.addField('entity_all_hv_ss', obj[0][ref].name + \" \" + obj[0][allKeys[i]]._type);\n                                doc.addField('entity_all_payloads', obj[0][ref].name + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n                                if (double_take) {\n                                    // add the company even if the display is off\n                                    //      doc.addField('entity_company_ss', obj[0][ref1].name);\n                                    //  doc.addField('entity_first1_ss', ref1 +\" _ \"+obj[0][allKeys[i]]._type );\n                                    doc.addField('Company_Events_ss', obj[0][ref1].name + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('entity_all_mv_ss', obj[0][ref1].name + \" \" + obj[0][allKeys[i]]._type);\n\n                                    doc.addField('entity_all_payloads', obj[0][ref1].name + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n                                }\n                                if (obj[0][ref].resolutions != null) {\n                                    doc.addField('event_support_ss', obj[0][ref].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('event_support_ss', obj[0][ref].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('entity_all_mv_ss', obj[0][ref].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('entity_all_mv_ss', obj[0][ref].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n\n                                    doc.addField('entity_all_payloads', obj[0][ref].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n                                    doc.addField('entity_all_payloads', obj[0][ref].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n\n                                }\n                            } else {\n                                doc.addField('entity_all_hv_ss', obj[0][ref].name + \" \" + obj[0][allKeys[i]]._type);\n\n                                doc.addField('entity_all_payloads', obj[0][ref].name + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n\n                                if (double_take) {\n                                    // add the company even if the display is off\n                                    //      doc.addField('entity_company_ss', obj[0][ref1].name);\n                                    //  doc.addField('entity_first1_ss', ref1 +\" _ \"+obj[0][allKeys[i]]._type );\n                                    doc.addField('Company_Events_ss', obj[0][ref1].name + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('entity_all_lv_ss', obj[0][ref1].name + \" \" + obj[0][allKeys[i]]._type);\n\n                                    doc.addField('entity_all_payloads', obj[0][ref1].name + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n\n                                }\n                                if (obj[0][ref].resolutions != null) {\n                                    doc.addField('event_support_ss', obj[0][ref].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('event_support_ss', obj[0][ref].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('entity_all_lv_ss', obj[0][ref].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type);\n                                    doc.addField('entity_all_lv_ss', obj[0][ref].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type);\n\n                                    doc.addField('entity_all_payloads', obj[0][ref].resolutions[0].permid + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n                                    doc.addField('entity_all_payloads', obj[0][ref].resolutions[0].primaryric + \" \" + obj[0][allKeys[i]]._type + '|' + refScore);\n\n                                }\n                            }\n\n                        }\n                    }\n                }\n            }\n        }\n\n\n    }\n    // doc.removeFields(\"responseValue\");\n\n    return doc;\n}\n",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Entity Extraction: Parse Events",
        "licensed" : true,
        "secretSourceStageId" : "kb"
      }, {
        "type" : "javascript-index",
        "id" : "anl",
        "script" : "function(doc) {\n\n    var responseValue = doc.getFieldValues('responseValue');\n\n    var obj;\n    try {\n        obj = JSON.parse(responseValue);\n    } catch (err) {\n        doc.setField(\"version\", \"untagged\");\n        return doc;\n    }\n\n    if (obj == null || (typeof obj == 'undefined') || (typeof obj[0] == 'undefined'))\n        return doc;\n\n    // array to store the name of companies\\\n    var companies = [];\n    // array to store the name of thier respective permids\\\n    var comp_permids = \"\";\n\n    // Get all the Key in the response\\\n    var allKeys = Object.keys(obj[0]);\n\n    // doc.addField('Field Val', Object.keys(obj[0]));\\\n\n    if (allKeys != null) {\n\n        for (i = 0; i < allKeys.length; ++i) {\n\n            tag = obj[0][allKeys[i]]._typeGroup;\n            type = obj[0][allKeys[i]]._type;\n\n\n            if (tag != null && tag.equals(\"industry\")) {\n                doc.addField('industry_tags_ss', obj[0][allKeys[i]].name);\n\n                doc.addField('industry_tags_payloads', obj[0][allKeys[i]].name + '|' + obj[0][allKeys[i]].relevance);\n\n                if (parseFloat(obj[0][allKeys[i]].relevance) >= .8) {\n                    doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].name);\n                    doc.addField('industry_tags_hv_ss', obj[0][allKeys[i]].name);\n                } else if (parseFloat(obj[0][allKeys[i]].relevance) >= .5) {\n                    doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].name);\n                    doc.addField('industry_tags_mv_ss', obj[0][allKeys[i]].name);\n\n                } else {\n                    doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].name);\n                    doc.addField('industry_tags_lv_ss', obj[0][allKeys[i]].name);\n                }\n            }\n\n\n        }\n    }\n\n    return doc;\n}",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Entity Extraction: Parse Industries",
        "licensed" : true,
        "secretSourceStageId" : "anl"
      }, {
        "type" : "javascript-index",
        "id" : "ebo",
        "script" : "function(doc) {\n\n    var responseValue = doc.getFieldValues('responseValue');\n\n    var obj;\n    try {\n        obj = JSON.parse(responseValue);\n    } catch (err) {\n        doc.setField(\"version\", \"untagged\");\n        return doc;\n    }\n\n    if (obj == null || (typeof obj == 'undefined') || (typeof obj[0] == 'undefined'))\n        return doc;\n\n    // array to store the name of companies\\\n    var companies = [];\n    // array to store the name of thier respective permids\\\n    var comp_permids = \"\";\n\n    // Get all the Key in the response\\\n    var allKeys = Object.keys(obj[0]);\n\n    // doc.addField('Field Val', Object.keys(obj[0]));\\\n\n    if (allKeys != null) {\n\n        for (i = 0; i < allKeys.length; ++i) {\n\n            tag = obj[0][allKeys[i]]._typeGroup;\n            type = obj[0][allKeys[i]]._type;\n\n            if (tag != null && tag.equals(\"topics\")) {\n                if (obj[0][allKeys[i]].rcscode != null) {\n\n                    doc.addField('topics_tags_ss', obj[0][allKeys[i]].name);\n                    doc.addField('topics_tags_payloads', obj[0][allKeys[i]].name + '|' + obj[0][allKeys[i]].score);\n\n                    if (parseFloat(obj[0][allKeys[i]].score) >= .8) {\n                        doc.addField('entity_all_hv_ss', obj[0][allKeys[i]].name);\n                        doc.addField('topics_tags_hv_ss', obj[0][allKeys[i]].name);\n                    } else if (parseFloat(obj[0][allKeys[i]].score) >= .5) {\n                        doc.addField('entity_all_mv_ss', obj[0][allKeys[i]].name);\n                        doc.addField('topics_tags_mv_ss', obj[0][allKeys[i]].name);\n                    } else {\n                        doc.addField('entity_all_lv_ss', obj[0][allKeys[i]].name);\n                        doc.addField('topics_tags_lv_ss', obj[0][allKeys[i]].name);\n                    }\n                }\n            }\n        }\n    }\n\n    return doc;\n}\n",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Entity Extraction: Parse Topics",
        "licensed" : true,
        "secretSourceStageId" : "ebo"
      }, {
        "type" : "field-mapping",
        "id" : "md",
        "mappings" : [ {
          "source" : "entity_company_mv_ss",
          "target" : "entity_company_mv_txt",
          "operation" : "copy"
        }, {
          "source" : "entity_company_hv_ss",
          "target" : "entity_company_hv_txt",
          "operation" : "copy"
        }, {
          "source" : "entity_company_lv_ss",
          "target" : "entity_company_lv_txt",
          "operation" : "copy"
        }, {
          "source" : "entity_person_hv_ss",
          "target" : "entity_person_hv_txt",
          "operation" : "copy"
        }, {
          "source" : "entity_person_mv_ss",
          "target" : "entity_person_mv_txt",
          "operation" : "copy"
        }, {
          "source" : "entity_person_lv_ss",
          "target" : "entity_person_lv_txt",
          "operation" : "copy"
        }, {
          "source" : "industry_tags_hv_ss",
          "target" : "industry_tags_hv_txt",
          "operation" : "copy"
        }, {
          "source" : "industry_tags_mv_ss",
          "target" : "industry_tags_mv_txt",
          "operation" : "copy"
        }, {
          "source" : "industry_tags_lv_ss",
          "target" : "industry_tags_lv_txt",
          "operation" : "copy"
        }, {
          "source" : "social_tags_hv_ss",
          "target" : "social_tags_hv_txt",
          "operation" : "copy"
        }, {
          "source" : "social_tags_mv_ss",
          "target" : "social_tags_mv_txt",
          "operation" : "copy"
        }, {
          "source" : "social_tags_lv_ss",
          "target" : "social_tags_lv_txt",
          "operation" : "copy"
        }, {
          "source" : "entity_all_hv_ss",
          "target" : "entity_all_hv_txt",
          "operation" : "copy"
        }, {
          "source" : "entity_all_mv_ss",
          "target" : "entity_all_mv_txt",
          "operation" : "copy"
        }, {
          "source" : "entity_all_lv_ss",
          "target" : "entity_all_lv_txt",
          "operation" : "copy"
        } ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "label" : "Entity Extraction: Search Field Setup",
        "licensed" : true,
        "secretSourceStageId" : "md"
      }, {
        "type" : "index-logging",
        "id" : "xhb",
        "detailed" : true,
        "type" : "index-logging",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "xhb"
      }, {
        "type" : "field-mapping",
        "id" : "95c06938-6bfe-471c-bbfa-4d56c6fbc1de",
        "mappings" : [ ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "95c06938-6bfe-471c-bbfa-4d56c6fbc1de"
      }, {
        "type" : "solr-dynamic-field-name-mapping",
        "id" : "4694c155-01b8-4197-9b6b-e49eefc4b144",
        "duplicateSingleValuedFields" : false,
        "fieldsToExclude" : [ ],
        "advancedTextFieldsIndexing" : true,
        "maxTextLengthForAdvancedIndexing" : 100,
        "type" : "solr-dynamic-field-name-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "4694c155-01b8-4197-9b6b-e49eefc4b144"
      }, {
        "type" : "solr-index",
        "id" : "a2841923-69dd-4c1b-b649-cb3f68976017",
        "enforceSchema" : true,
        "dateFormats" : [ ],
        "params" : [ ],
        "bufferDocsForSolr" : false,
        "type" : "solr-index",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "a2841923-69dd-4c1b-b649-cb3f68976017"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "yahoo-news"
      }
    }, {
      "id" : "user_buckets",
      "stages" : [ {
        "type" : "javascript-index",
        "id" : "h6i",
        "script" : "function(doc) {\n\n  if (doc !== null && doc.hasField('ticker')) {\n    var ticker = doc.getFirstFieldValue('ticker');\n    logger.info('Getting key stats for ' + ticker);\n    if (ticker !== null) {\n    \n      var entityUtils = Packages.org.apache.http.util.EntityUtils;\n      var httpClient = org.apache.http.impl.client.HttpClients.createDefault();\n      var url = 'https://api.iextrading.com/1.0/stock/' + ticker + '/stats';\n      var httpGet = new org.apache.http.client.methods.HttpGet(url);\n\n      var response = entityUtils.toString(httpClient.execute(httpGet).getEntity());\n      var stats_record = JSON.parse(response);\n\n      doc.addField('marketcap_f', stats_record.marketcap);\n      doc.addField('div_yield_f', stats_record.dividendYield);\n      doc.addField('eps_f', stats_record.latestEPS);\n      doc.addField('eps_date_dt', stats_record.latestEPSDate);\n      doc.addField('eps_fy1_f', stats_record.consensusEPS);\n      doc.addField('ebitda_f', stats_record.EBITDA);\n      doc.addField('revenue_f', stats_record.revenue);\n      doc.addField('price_to_book_f', stats_record.priceToBook);\n      doc.addField('beta_f', stats_record.beta);\n    }\n  }\n  // IEX doesn't like to be hit hard, sleep for a bit to throttle\n  java.lang.Thread.sleep(200);\n  return doc;\n}",
        "type" : "javascript-index",
        "skip" : false,
        "label" : "Add Key Stats",
        "licensed" : true,
        "secretSourceStageId" : "h6i"
      }, {
        "type" : "solr-dynamic-field-name-mapping",
        "id" : "2a4f6a47-2b7e-48b5-9527-78c874f36728",
        "duplicateSingleValuedFields" : false,
        "fieldsToExclude" : [ ],
        "advancedTextFieldsIndexing" : true,
        "maxTextLengthForAdvancedIndexing" : 100,
        "type" : "solr-dynamic-field-name-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "2a4f6a47-2b7e-48b5-9527-78c874f36728"
      }, {
        "type" : "field-mapping",
        "id" : "52ab63cd-24b7-4855-8390-65b86a8638d9",
        "mappings" : [ {
          "source" : "weight_s",
          "target" : "weight_d",
          "operation" : "copy"
        }, {
          "source" : "bucket_value_s",
          "target" : "bucket_value_f",
          "operation" : "copy"
        }, {
          "source" : "bucket_value_total_s",
          "target" : "bucket_value_total_f",
          "operation" : "copy"
        }, {
          "source" : "bucket_ytd_ror_s",
          "target" : "bucket_ytd_ror_f",
          "operation" : "copy"
        }, {
          "source" : "bucket_total_clients_s",
          "target" : "bucket_total_clients_i",
          "operation" : "copy"
        } ],
        "reservedFieldsMappingAllowed" : false,
        "type" : "field-mapping",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "52ab63cd-24b7-4855-8390-65b86a8638d9"
      }, {
        "type" : "solr-index",
        "id" : "81b46e9d-eee1-4907-aa14-0bae9ef3d81c",
        "enforceSchema" : true,
        "dateFormats" : [ ],
        "params" : [ ],
        "bufferDocsForSolr" : false,
        "type" : "solr-index",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "81b46e9d-eee1-4907-aa14-0bae9ef3d81c"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "user_buckets"
      }
    } ],
    "queryPipelines" : [ {
      "id" : "Finance_signals",
      "stages" : [ {
        "type" : "recommendation",
        "id" : "fdcc7f93-be19-4c6f-82c1-8e4d7d860ae2",
        "numRecommendations" : 10,
        "numSignals" : 100,
        "aggrType" : "click@doc_id,filters,query",
        "boostId" : "id",
        "boostingMethod" : "query-param",
        "boostingParam" : "boost",
        "queryParams" : [ {
          "key" : "qf",
          "value" : "query_t"
        }, {
          "key" : "pf",
          "value" : "query_t^50"
        }, {
          "key" : "pf",
          "value" : "query_t~3^20"
        }, {
          "key" : "pf2",
          "value" : "query_t^20"
        }, {
          "key" : "pf2",
          "value" : "query_t~3^10"
        }, {
          "key" : "pf3",
          "value" : "query_t^10"
        }, {
          "key" : "pf3",
          "value" : "query_t~3^5"
        }, {
          "key" : "boost",
          "value" : "map(query({!field f=query_s v=$q}),0,0,1,20)"
        }, {
          "key" : "mm",
          "value" : "50%"
        }, {
          "key" : "defType",
          "value" : "edismax"
        }, {
          "key" : "sort",
          "value" : "score desc, weight_d desc"
        } ],
        "rollupField" : "doc_id_s",
        "rollupWeightField" : "weight_d",
        "weightExpression" : "math:log(weight_d + 1) + 10 * math:log(score+1)",
        "rollupWeightStrategy" : "max",
        "type" : "recommendation",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "fdcc7f93-be19-4c6f-82c1-8e4d7d860ae2"
      }, {
        "type" : "search-fields",
        "id" : "b940656d-b788-4080-b3cd-93142d3e83d6",
        "rows" : 10,
        "start" : 0,
        "queryFields" : [ ],
        "returnFields" : [ "*", "score" ],
        "type" : "search-fields",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "b940656d-b788-4080-b3cd-93142d3e83d6"
      }, {
        "type" : "facet",
        "id" : "59edef9e-a007-4625-afba-7a1cc33eeef5",
        "fieldFacets" : [ {
          "field" : "type",
          "minCount" : 1,
          "missing" : false
        } ],
        "type" : "facet",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "59edef9e-a007-4625-afba-7a1cc33eeef5"
      }, {
        "type" : "solr-query",
        "id" : "329269c0-3792-4594-8ec9-abc6b6faf1cf",
        "allowedRequestHandlers" : [ ],
        "httpMethod" : "POST",
        "allowFederatedSearch" : false,
        "type" : "solr-query",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "329269c0-3792-4594-8ec9-abc6b6faf1cf"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "Finance_signals"
      }
    }, {
      "id" : "Finance",
      "stages" : [ {
        "type" : "javascript-query",
        "id" : "n6l",
        "script" : "var display_money = function(num) {\n  if (num > 1000000000) {\n    return '$' + (num / 1000000000).toFixed(2) + 'B';\n  } else if (num > 1000000) {\n    return '$' + (num / 1000000).toFixed(2) + 'M';\n  } else {\n    return '$' + (num / 1000000).toFixed(2)\n  }\n}\nfunction(request, response, ctx, collection, solrServer, solrServerFactory) {\n  var q = request.getFirstParam('q');\n  if(!q) {\n    return;  // To avoid NPA\n  }\n\n  var firstToken = q;\n  var remainder = '';\n\n  if (q.indexOf(' ') >= 0) {\n  \tfirstToken = q.substring(0, q.indexOf(' ')).replace(/\\(/, '');\n    remainder = q.substring(q.indexOf(' '), q.length);\n    remainder = remainder.trim();\n    remainder = remainder.replace(/\\s+/g, ' ');\n  }\n\n  logger.info('Answer card: first token is ' + firstToken);\n\n  if (!firstToken.match(/\\*/)) {\n    var query = new org.apache.solr.client.solrj.SolrQuery('ticker_s:'+firstToken.toUpperCase());\n    query.addFilterQuery('_lw_data_source_s:sp500');\n    query.setRows(1);\n    var results = solrServerFactory.getSolrServer('Finance').query(query).getResults();\n    if (results.size() > 0) {  // A ticker was found\n      var tickerResult = results.get(0);\n      var ticker  = tickerResult.get('ticker_s');\n      \n      var company_name = ticker;\n      var query_company_name = new org.apache.solr.client.solrj.SolrQuery('ticker_s:'+firstToken.toUpperCase());\n      query_company_name.addFilterQuery('_lw_data_source_s:sp500');\n      query_company_name.setRows(1);\n      var company_name_results = solrServerFactory.getSolrServer('Finance').query(query_company_name).getResults();\n      if (company_name_results.size() > 0) {\n      \tcompany_name  = company_name_results.get(0).get('company_name_t');\n      }\n      // TODO: other patterns\n      if (remainder.match(/ebitda/i)) {\n        var ebitda  = tickerResult.get('ebitda_f').toFixed(2);\n        logger.info('Answer Card: will append EBITDA to result: ' + ebitda);\n\n        ctx.setProperty(\"co_answer_card_company\", company_name);\n        ctx.setProperty(\"co_answer_card_metric_label\", \"EBITDA\");\n        ctx.setProperty(\"co_answer_card_metric_value\", display_money(ebitda));\n      } else if (remainder.match(/dividend/i)) {\n        var dividend  = tickerResult.get('div_yield_f').toFixed(2);\n        logger.info('Answer Card: will append dividend to result: ' + dividend);\n\n        ctx.setProperty(\"co_answer_card_company\", company_name);\n        ctx.setProperty(\"co_answer_card_metric_label\", \"dividend yield\");\n        ctx.setProperty(\"co_answer_card_metric_value\", dividend);\n      } else if (remainder.match(/eps/i) || remainder.match(/earnings/i)) {\n        var eps  = tickerResult.get('eps_fy1_f').toFixed(2);\n        logger.info('Answer Card: will append eps to result: ' + eps);\n\n        ctx.setProperty(\"co_answer_card_company\", company_name);\n        ctx.setProperty(\"co_answer_card_metric_label\", \"earnings per share\");\n        ctx.setProperty(\"co_answer_card_metric_value\", display_money(eps));\n      } else if (remainder.match(/beta/i)) {\n        var beta  = tickerResult.get('beta_f').toFixed(2);\n        logger.info('Answer Card: will append beta to result: ' + beta);\n\n        ctx.setProperty(\"co_answer_card_company\", company_name);\n        ctx.setProperty(\"co_answer_card_metric_label\", \"beta\");\n        ctx.setProperty(\"co_answer_card_metric_value\", beta);\n      }\n    }\n  }\n}\n",
        "type" : "javascript-query",
        "skip" : false,
        "label" : "Query for Answer Card Data",
        "licensed" : true,
        "secretSourceStageId" : "n6l"
      }, {
        "type" : "sub-query",
        "id" : "flo",
        "key" : "company-buckets",
        "collection" : "Finance",
        "handler" : "select",
        "method" : "GET",
        "parentParams" : [ "username" ],
        "rollupKeys" : [ ],
        "params" : [ {
          "key" : "fq",
          "value" : "{!field f=owner_s v=$username}"
        }, {
          "key" : "q",
          "value" : "*:*"
        } ],
        "headers" : [ ],
        "type" : "sub-query",
        "skip" : false,
        "label" : "User Companies: query for companies",
        "condition" : "request.hasParam(\"username\") && !request.hasParam(\"portfolio\")",
        "licensed" : true,
        "secretSourceStageId" : "flo"
      }, {
        "type" : "sub-query",
        "id" : "e9",
        "key" : "company-buckets",
        "collection" : "Finance",
        "handler" : "select",
        "method" : "GET",
        "parentParams" : [ "portfolio" ],
        "rollupKeys" : [ ],
        "params" : [ {
          "key" : "fq",
          "value" : "{!field f=unique_bucket_id_s v=$portfolio}"
        }, {
          "key" : "q",
          "value" : "*:*"
        } ],
        "headers" : [ ],
        "type" : "sub-query",
        "skip" : false,
        "label" : "User Portfolio: query for companies within portfolio",
        "condition" : "request.hasParam(\"portfolio\")",
        "licensed" : true,
        "secretSourceStageId" : "e9"
      }, {
        "type" : "javascript-query",
        "id" : "2re",
        "script" : "if (ctx.hasProperty('company-buckets')) {\n  var company_buckets = ctx.getProperty('company-buckets');\n  logger.info('Company Portfolios: has results!');\n  if (company_buckets.response !== null\n        && company_buckets.response.docs !== null\n        && company_buckets.response.docs.length > 0) {\n    var bucket_docs = company_buckets.response.docs;\n    var company_disjunction = '(';\n    for (var i = 0; i < bucket_docs.length; i++) {\n    \tvar ticker = bucket_docs[i].ticker_s;\n      \tvar company_name = bucket_docs[i].company_name_s;\n\t\tvar weight = bucket_docs[i].weight_d;\n        logger.info('Company Portfolios: adding boost for ' + company_name);\n      \trequest.addParam('bq', \"entity_stock_ticker_mv_ss:\" + ticker + \"*^10\");\n      \trequest.addParam('bq', \"ticker_s:(\" + ticker + \")^10\");\n      \trequest.addParam('bq', \"title_t:\" + company_name + \"^20\");\n      \trequest.addParam('bq', \"title_t:\" + ticker + \"^100\");\n        if (i > 0) {\n          company_disjunction = company_disjunction + \" OR \";\n        }\n        company_disjunction = company_disjunction + \"ticker_s:\" + ticker + \" OR entity_stock_ticker_mv_ss:\" + ticker + \"* OR title_t:\" + ticker + \" OR title_t:\\\"\" + company_name + \"\\\"\";\n    }\n    company_disjunction = company_disjunction + ')';\n    request.addParam('fq', company_disjunction);\n  }\n}",
        "type" : "javascript-query",
        "skip" : false,
        "label" : "User Companies: extract companies and boost",
        "licensed" : true,
        "secretSourceStageId" : "2re"
      }, {
        "type" : "facet",
        "id" : "d53dccad-087d-4aa1-bb3f-a3e20b39fa34",
        "fieldFacets" : [ {
          "field" : "_lw_data_source_s",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "ticker_s",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "entity_person_hv_ss",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "entity_company_hv_ss",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "Company_Events_ss",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "industry_tags_hv_ss",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "entity_country_hv_ss",
          "minCount" : 1,
          "missing" : false
        } ],
        "type" : "facet",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "d53dccad-087d-4aa1-bb3f-a3e20b39fa34",
        "properties" : {
          "autoCreated" : true
        }
      }, {
        "type" : "search-fields",
        "id" : "7v5",
        "rows" : 10,
        "start" : 0,
        "queryFields" : [ ],
        "returnFields" : [ "*", "score" ],
        "type" : "search-fields",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "7v5"
      }, {
        "type" : "solr-query",
        "id" : "0028257e-a5f6-4697-ab45-3f12e6e366e6",
        "allowedRequestHandlers" : [ ],
        "httpMethod" : "POST",
        "allowFederatedSearch" : false,
        "type" : "solr-query",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "0028257e-a5f6-4697-ab45-3f12e6e366e6"
      }, {
        "type" : "javascript-query",
        "id" : "efp",
        "script" : "function(request, response, ctx, collection, solrServer, solrServerFactory) {\n  if (ctx.hasProperty(\"co_answer_card_company\")) {\n    var answer_card_content = ctx.getProperty(\"co_answer_card_company\") + \"'s \";\n    answer_card_content = answer_card_content + ctx.getProperty(\"co_answer_card_metric_label\") + \" is \";\n    answer_card_content = answer_card_content + ctx.getProperty(\"co_answer_card_metric_value\");\n    response.initialEntity.appendString(\"co_answer_card_content\", answer_card_content);\n  }\n}",
        "type" : "javascript-query",
        "skip" : false,
        "label" : "Augment with Answer Card Data",
        "licensed" : true,
        "secretSourceStageId" : "efp"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "Finance"
      }
    }, {
      "id" : "buckets",
      "stages" : [ {
        "type" : "facet",
        "id" : "88e0b352-28f2-46cc-b192-83488ee295e4",
        "fieldFacets" : [ ],
        "type" : "facet",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "88e0b352-28f2-46cc-b192-83488ee295e4"
      }, {
        "type" : "solr-query",
        "id" : "3a2f49b6-a5bf-4183-b4f6-ac95fd57d93f",
        "allowedRequestHandlers" : [ ],
        "httpMethod" : "POST",
        "allowFederatedSearch" : false,
        "type" : "solr-query",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "3a2f49b6-a5bf-4183-b4f6-ac95fd57d93f"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "buckets"
      }
    }, {
      "id" : "Finance_signals_aggr",
      "stages" : [ {
        "type" : "recommendation",
        "id" : "b083a011-bfd6-4ba6-9366-9b639ede912a",
        "numRecommendations" : 10,
        "numSignals" : 100,
        "aggrType" : "click@doc_id,filters,query",
        "boostId" : "id",
        "boostingMethod" : "query-param",
        "boostingParam" : "boost",
        "queryParams" : [ {
          "key" : "qf",
          "value" : "query_t"
        }, {
          "key" : "pf",
          "value" : "query_t^50"
        }, {
          "key" : "pf",
          "value" : "query_t~3^20"
        }, {
          "key" : "pf2",
          "value" : "query_t^20"
        }, {
          "key" : "pf2",
          "value" : "query_t~3^10"
        }, {
          "key" : "pf3",
          "value" : "query_t^10"
        }, {
          "key" : "pf3",
          "value" : "query_t~3^5"
        }, {
          "key" : "boost",
          "value" : "map(query({!field f=query_s v=$q}),0,0,1,20)"
        }, {
          "key" : "mm",
          "value" : "50%"
        }, {
          "key" : "defType",
          "value" : "edismax"
        }, {
          "key" : "sort",
          "value" : "score desc, weight_d desc"
        } ],
        "rollupField" : "doc_id_s",
        "rollupWeightField" : "weight_d",
        "weightExpression" : "math:log(weight_d + 1) + 10 * math:log(score+1)",
        "rollupWeightStrategy" : "max",
        "type" : "recommendation",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "b083a011-bfd6-4ba6-9366-9b639ede912a"
      }, {
        "type" : "search-fields",
        "id" : "a11e5076-4494-4e0e-975e-8b95ec1d37c2",
        "rows" : 10,
        "start" : 0,
        "queryFields" : [ ],
        "returnFields" : [ "*", "score" ],
        "type" : "search-fields",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "a11e5076-4494-4e0e-975e-8b95ec1d37c2"
      }, {
        "type" : "facet",
        "id" : "69082f6a-25d2-4acc-a5e5-33d5e88ed4b6",
        "fieldFacets" : [ ],
        "type" : "facet",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "69082f6a-25d2-4acc-a5e5-33d5e88ed4b6"
      }, {
        "type" : "solr-query",
        "id" : "74bae31b-e151-4a95-b8cf-5d7f7c467013",
        "allowedRequestHandlers" : [ ],
        "httpMethod" : "POST",
        "allowFederatedSearch" : false,
        "type" : "solr-query",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "74bae31b-e151-4a95-b8cf-5d7f7c467013"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "Finance_signals_aggr"
      }
    }, {
      "id" : "finance-default",
      "stages" : [ {
        "type" : "recommendation",
        "id" : "f6d1d9b1-3ed6-4f7f-8bbe-1e11ec7bf4c7",
        "numRecommendations" : 10,
        "numSignals" : 100,
        "aggrType" : "click@doc_id,filters,query",
        "boostId" : "id",
        "boostingMethod" : "query-param",
        "boostingParam" : "boost",
        "queryParams" : [ {
          "key" : "qf",
          "value" : "query_t"
        }, {
          "key" : "pf",
          "value" : "query_t^50"
        }, {
          "key" : "pf",
          "value" : "query_t~3^20"
        }, {
          "key" : "pf2",
          "value" : "query_t^20"
        }, {
          "key" : "pf2",
          "value" : "query_t~3^10"
        }, {
          "key" : "pf3",
          "value" : "query_t^10"
        }, {
          "key" : "pf3",
          "value" : "query_t~3^5"
        }, {
          "key" : "boost",
          "value" : "map(query({!field f=query_s v=$q}),0,0,1,20)"
        }, {
          "key" : "mm",
          "value" : "50%"
        }, {
          "key" : "defType",
          "value" : "edismax"
        }, {
          "key" : "sort",
          "value" : "score desc, weight_d desc"
        } ],
        "rollupField" : "doc_id_s",
        "rollupWeightField" : "weight_d",
        "weightExpression" : "math:log(weight_d + 1) + 10 * math:log(score+1)",
        "rollupWeightStrategy" : "max",
        "type" : "recommendation",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "f6d1d9b1-3ed6-4f7f-8bbe-1e11ec7bf4c7"
      }, {
        "type" : "search-fields",
        "id" : "c2105f8b-f55f-4114-9468-9d7e6072973e",
        "rows" : 10,
        "start" : 0,
        "queryFields" : [ ],
        "returnFields" : [ "*", "score" ],
        "type" : "search-fields",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "c2105f8b-f55f-4114-9468-9d7e6072973e"
      }, {
        "type" : "facet",
        "id" : "8dd6385a-716a-47e8-aeb6-494934b2ef43",
        "fieldFacets" : [ ],
        "type" : "facet",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "8dd6385a-716a-47e8-aeb6-494934b2ef43"
      }, {
        "type" : "solr-query",
        "id" : "814d21e1-f7df-4cdb-bd3d-8e87d906b348",
        "allowedRequestHandlers" : [ ],
        "httpMethod" : "POST",
        "allowFederatedSearch" : false,
        "type" : "solr-query",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "814d21e1-f7df-4cdb-bd3d-8e87d906b348"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "finance-default"
      }
    }, {
      "id" : "queries-facets",
      "stages" : [ {
        "type" : "set-params",
        "id" : "vnp",
        "params" : [ {
          "key" : "fq",
          "value" : "-query:/id:\\(.*/",
          "policy" : "append"
        }, {
          "key" : "fq",
          "value" : "-query:\\*\\:\\*",
          "policy" : "append"
        }, {
          "key" : "fq",
          "value" : "-query:/id:.*/",
          "policy" : "append"
        } ],
        "type" : "set-params",
        "skip" : false,
        "label" : "Filter out blank and id queries",
        "licensed" : true,
        "secretSourceStageId" : "vnp"
      }, {
        "type" : "search-fields",
        "id" : "1d41b413-e543-4f96-beaa-cb5ed41fb9b6",
        "rows" : 10,
        "start" : 0,
        "queryFields" : [ {
          "field" : "query_t"
        } ],
        "returnFields" : [ "*", "score" ],
        "type" : "search-fields",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "1d41b413-e543-4f96-beaa-cb5ed41fb9b6",
        "properties" : {
          "autoCreated" : true
        }
      }, {
        "type" : "set-params",
        "id" : "ste",
        "params" : [ {
          "key" : "fq",
          "value" : "timestamp_tdt:[NOW/DAY-5DAY TO NOW/DAY+1DAY]",
          "policy" : "append"
        }, {
          "key" : "fq",
          "value" : "type:request",
          "policy" : "append"
        }, {
          "key" : "rows",
          "value" : "0",
          "policy" : "append"
        }, {
          "key" : "f.query.facet.limit",
          "value" : "5",
          "policy" : "append"
        } ],
        "type" : "set-params",
        "skip" : false,
        "label" : "Tracked queries last 30 days",
        "licensed" : true,
        "secretSourceStageId" : "ste"
      }, {
        "type" : "facet",
        "id" : "16c529a7-9281-48c9-bc61-0c178780c27b",
        "fieldFacets" : [ {
          "field" : "query",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "type",
          "minCount" : 1,
          "missing" : false
        } ],
        "type" : "facet",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "16c529a7-9281-48c9-bc61-0c178780c27b",
        "properties" : {
          "autoCreated" : true
        }
      }, {
        "type" : "solr-query",
        "id" : "69cf432d-7836-4d78-9a3f-993a3b8437b9",
        "allowedRequestHandlers" : [ ],
        "httpMethod" : "POST",
        "allowFederatedSearch" : false,
        "type" : "solr-query",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "69cf432d-7836-4d78-9a3f-993a3b8437b9",
        "properties" : {
          "autoCreated" : true
        }
      } ],
      "properties" : {
        "secretSourcePipelineId" : "queries-facets"
      }
    }, {
      "id" : "suggest",
      "stages" : [ {
        "type" : "facet",
        "id" : "caa61be2-1a8f-4bee-b60a-097dca25ba55",
        "fieldFacets" : [ ],
        "type" : "facet",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "caa61be2-1a8f-4bee-b60a-097dca25ba55"
      }, {
        "type" : "solr-query",
        "id" : "9c452c49-dad6-4af7-af11-bc4ce840f52d",
        "allowedRequestHandlers" : [ "suggest" ],
        "httpMethod" : "POST",
        "allowFederatedSearch" : false,
        "type" : "solr-query",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "9c452c49-dad6-4af7-af11-bc4ce840f52d"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "suggest"
      }
    }, {
      "id" : "latest-news",
      "stages" : [ {
        "type" : "javascript-query",
        "id" : "79f",
        "script" : "if (ctx.hasProperty('company-buckets')) {\n  var company_buckets = ctx.getProperty('company-buckets');\n  logger.info('Company Portfolios: has results');\n  if (company_buckets.response !== null\n        && company_buckets.response.docs !== null\n        && company_buckets.response.docs.length > 0) {\n    var bucket_docs = company_buckets.response.docs;\n    for (var i = 0; i < bucket_docs.length; i++) {\n    \tvar ticker = bucket_docs[i].ticker_s;\n      \tvar company_name = bucket_docs[i].company_name_s;\n\t\tvar weight = bucket_docs[i].weight_d;\n      \trequest.addParam('bq', \"entity_stock_ticker_mv_ss:\" + ticker + \"*^10\");\n      \trequest.addParam('bq', \"ticker_s:\" + ticker + \"^10\");\n      \trequest.addParam('bq', \"title_t:\" + company_name + \"^20\");\n      \trequest.addParam('bq', \"title_t:\" + ticker + \"^100\");\n    }\n  }\n}",
        "type" : "javascript-query",
        "skip" : true,
        "label" : "User Portfolios: extract companies and boost",
        "licensed" : true,
        "secretSourceStageId" : "79f"
      }, {
        "type" : "sub-query",
        "id" : "oyk",
        "key" : "company-buckets",
        "collection" : "Finance",
        "handler" : "select",
        "method" : "GET",
        "parentParams" : [ "username" ],
        "rollupKeys" : [ ],
        "params" : [ {
          "key" : "fq",
          "value" : "{!field f=owner_s v=$username}"
        }, {
          "key" : "q",
          "value" : "*:*"
        } ],
        "headers" : [ ],
        "type" : "sub-query",
        "skip" : false,
        "label" : "User Portfolios: query for portfolios",
        "condition" : "request.hasParam(\"username\")",
        "licensed" : true,
        "secretSourceStageId" : "oyk"
      }, {
        "type" : "javascript-query",
        "id" : "wzk",
        "script" : "var display_money = function(num) {\n  if (num > 1000000000) {\n    return '$' + (num / 1000000000).toFixed(2) + 'B';\n  } else if (num > 1000000) {\n    return '$' + (num / 1000000).toFixed(2) + 'M';\n  } else {\n    return '$' + (num / 1000000).toFixed(2)\n  }\n}\nfunction(request, response, ctx, collection, solrServer, solrServerFactory) {\n  var q = request.getFirstParam('q');\n  if(!q) {\n    return;  // To avoid NPA\n  }\n\n  var firstToken = q;\n  var remainder = '';\n\n  if (q.indexOf(' ') >= 0) {\n  \tfirstToken = q.substring(0, q.indexOf(' ')).replace(/\\(/, '');\n    remainder = q.substring(q.indexOf(' '), q.length);\n    remainder = remainder.trim();\n    remainder = remainder.replace(/\\s+/g, ' ');\n  }\n\n  logger.info('Answer card: first token is ' + firstToken);\n\n  if (!firstToken.match(/\\*/)) {\n    var query = new org.apache.solr.client.solrj.SolrQuery('ticker_s:'+firstToken.toUpperCase());\n    query.addFilterQuery('_lw_data_source_s:sp500');\n    query.setRows(1);\n    var results = solrServerFactory.getSolrServer('Finance').query(query).getResults();\n    if (results.size() > 0) {  // A ticker was found\n      var tickerResult = results.get(0);\n      var ticker  = tickerResult.get('ticker_s');\n      \n      var company_name = ticker;\n      var query_company_name = new org.apache.solr.client.solrj.SolrQuery('ticker_s:'+firstToken.toUpperCase());\n      query_company_name.addFilterQuery('_lw_data_source_s:sp500');\n      query_company_name.setRows(1);\n      var company_name_results = solrServerFactory.getSolrServer('Finance').query(query_company_name).getResults();\n      if (company_name_results.size() > 0) {\n      \tcompany_name  = company_name_results.get(0).get('company_name_t');\n      }\n      // TODO: other patterns\n      if (remainder.match(/ebitda/i)) {\n        var ebitda  = tickerResult.get('ebitda_f').toFixed(2);\n        logger.info('Answer Card: will append EBITDA to result: ' + ebitda);\n\n        ctx.setProperty(\"co_answer_card_company\", company_name);\n        ctx.setProperty(\"co_answer_card_metric_label\", \"EBITDA\");\n        ctx.setProperty(\"co_answer_card_metric_value\", display_money(ebitda));\n      } else if (remainder.match(/dividend/i)) {\n        var dividend  = tickerResult.get('div_yield_f').toFixed(2);\n        logger.info('Answer Card: will append dividend to result: ' + dividend);\n\n        ctx.setProperty(\"co_answer_card_company\", company_name);\n        ctx.setProperty(\"co_answer_card_metric_label\", \"dividend yield\");\n        ctx.setProperty(\"co_answer_card_metric_value\", dividend);\n      } else if (remainder.match(/eps/i) || remainder.match(/earnings/i)) {\n        var eps  = tickerResult.get('eps_fy1_f').toFixed(2);\n        logger.info('Answer Card: will append eps to result: ' + eps);\n\n        ctx.setProperty(\"co_answer_card_company\", company_name);\n        ctx.setProperty(\"co_answer_card_metric_label\", \"earnings per share\");\n        ctx.setProperty(\"co_answer_card_metric_value\", display_money(eps));\n      } else if (remainder.match(/beta/i)) {\n        var beta  = tickerResult.get('beta_f').toFixed(2);\n        logger.info('Answer Card: will append beta to result: ' + beta);\n\n        ctx.setProperty(\"co_answer_card_company\", company_name);\n        ctx.setProperty(\"co_answer_card_metric_label\", \"beta\");\n        ctx.setProperty(\"co_answer_card_metric_value\", beta);\n      }\n    }\n  }\n}\n",
        "type" : "javascript-query",
        "skip" : false,
        "label" : "Query for Answer Card Data",
        "licensed" : true,
        "secretSourceStageId" : "wzk"
      }, {
        "type" : "recommendation",
        "id" : "79f5f931-6027-42cc-9997-c98b7101c645",
        "numRecommendations" : 10,
        "numSignals" : 100,
        "aggrType" : "click@doc_id,filters,query",
        "boostId" : "id",
        "boostingMethod" : "query-param",
        "boostingParam" : "boost",
        "queryParams" : [ {
          "key" : "qf",
          "value" : "query_t"
        }, {
          "key" : "pf",
          "value" : "query_t^50"
        }, {
          "key" : "pf",
          "value" : "query_t~3^20"
        }, {
          "key" : "pf2",
          "value" : "query_t^20"
        }, {
          "key" : "pf2",
          "value" : "query_t~3^10"
        }, {
          "key" : "pf3",
          "value" : "query_t^10"
        }, {
          "key" : "pf3",
          "value" : "query_t~3^5"
        }, {
          "key" : "boost",
          "value" : "map(query({!field f=query_s v=$q}),0,0,1,20)"
        }, {
          "key" : "mm",
          "value" : "50%"
        }, {
          "key" : "defType",
          "value" : "edismax"
        }, {
          "key" : "sort",
          "value" : "score desc, weight_d desc"
        } ],
        "rollupField" : "doc_id_s",
        "rollupWeightField" : "weight_d",
        "weightExpression" : "math:log(weight_d + 1) + 10 * math:log(score+1)",
        "rollupWeightStrategy" : "max",
        "type" : "recommendation",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "79f5f931-6027-42cc-9997-c98b7101c645"
      }, {
        "type" : "facet",
        "id" : "b68fc543-6dc8-4102-adea-92a969f4feef",
        "fieldFacets" : [ {
          "field" : "_lw_data_source_s",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "ticker_s",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "entity_person_hv_ss",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "entity_company_hv_ss",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "Company_Events_ss",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "industry_tags_hv_ss",
          "minCount" : 1,
          "missing" : false
        }, {
          "field" : "entity_country_hv_ss",
          "minCount" : 1,
          "missing" : false
        } ],
        "type" : "facet",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "b68fc543-6dc8-4102-adea-92a969f4feef"
      }, {
        "type" : "solr-query",
        "id" : "e4302c97-4913-4ce5-a384-e52d5f14e33c",
        "allowedRequestHandlers" : [ ],
        "httpMethod" : "POST",
        "allowFederatedSearch" : false,
        "type" : "solr-query",
        "skip" : false,
        "licensed" : true,
        "secretSourceStageId" : "e4302c97-4913-4ce5-a384-e52d5f14e33c"
      }, {
        "type" : "javascript-query",
        "id" : "jh",
        "script" : "function(request, response, ctx, collection, solrServer, solrServerFactory) {\n  if (ctx.hasProperty(\"co_answer_card_company\")) {\n    var answer_card_content = ctx.getProperty(\"co_answer_card_company\") + \"'s \";\n    answer_card_content = answer_card_content + ctx.getProperty(\"co_answer_card_metric_label\") + \" is \";\n    answer_card_content = answer_card_content + ctx.getProperty(\"co_answer_card_metric_value\");\n    response.initialEntity.appendString(\"co_answer_card_content\", answer_card_content);\n  }\n}",
        "type" : "javascript-query",
        "skip" : false,
        "label" : "Augment with Answer Card Data",
        "licensed" : true,
        "secretSourceStageId" : "jh"
      } ],
      "properties" : {
        "secretSourcePipelineId" : "latest-news"
      }
    } ],
    "features" : {
      "Finance_signals" : [ {
        "name" : "partitionByTime",
        "collectionId" : "Finance_signals",
        "params" : { },
        "enabled" : false
      }, {
        "name" : "signals",
        "collectionId" : "Finance_signals",
        "params" : { },
        "enabled" : false
      }, {
        "name" : "searchLogs",
        "collectionId" : "Finance_signals",
        "params" : { },
        "enabled" : false
      }, {
        "name" : "recommendations",
        "collectionId" : "Finance_signals",
        "params" : {
          "idField" : "id",
          "itemsForUser" : true,
          "itemsForQuery" : false,
          "itemsForItem" : true,
          "queriesForQuery" : false
        },
        "enabled" : false
      } ],
      "Finance" : [ {
        "name" : "partitionByTime",
        "collectionId" : "Finance",
        "params" : { },
        "enabled" : false
      }, {
        "name" : "signals",
        "collectionId" : "Finance",
        "params" : { },
        "enabled" : true
      }, {
        "name" : "searchLogs",
        "collectionId" : "Finance",
        "params" : { },
        "enabled" : true
      }, {
        "name" : "recommendations",
        "collectionId" : "Finance",
        "params" : {
          "idField" : "id",
          "itemsForUser" : true,
          "itemsForQuery" : false,
          "itemsForItem" : true,
          "queriesForQuery" : false
        },
        "enabled" : false
      } ],
      "Finance_signals_aggr" : [ {
        "name" : "partitionByTime",
        "collectionId" : "Finance_signals_aggr",
        "params" : { },
        "enabled" : false
      }, {
        "name" : "signals",
        "collectionId" : "Finance_signals_aggr",
        "params" : { },
        "enabled" : false
      }, {
        "name" : "searchLogs",
        "collectionId" : "Finance_signals_aggr",
        "params" : { },
        "enabled" : false
      }, {
        "name" : "recommendations",
        "collectionId" : "Finance_signals_aggr",
        "params" : {
          "idField" : "id",
          "itemsForUser" : true,
          "itemsForQuery" : false,
          "itemsForItem" : true,
          "queriesForQuery" : false
        },
        "enabled" : false
      } ]
    },
    "indexProfiles" : [ {
      "id" : "Finance-cUlP",
      "indexPipeline" : "Finance-SzaC",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance_signals",
      "indexPipeline" : "Finance_signals",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "Finance-bMgT",
      "indexPipeline" : "Finance-ZA1v",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance_signals-Roet",
      "indexPipeline" : "Finance_signals-BNNP",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "Finance_signals-lBdn",
      "indexPipeline" : "Finance_signals-DJHk",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "Finance_signals-A2dV",
      "indexPipeline" : "Finance_signals-2enH",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "Finance_signals-fIEO",
      "indexPipeline" : "Finance_signals-Tpmf",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr-hZD9",
      "indexPipeline" : "Finance_signals_aggr-QQSI",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    }, {
      "id" : "Finance_signals-Fpkw",
      "indexPipeline" : "Finance_signals-sedA",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "Finance_signals-JUwc",
      "indexPipeline" : "Finance_signals-NrMM",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "Finance_signals-9qAH",
      "indexPipeline" : "Finance_signals-qVoW",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "Finance-wdTQ",
      "indexPipeline" : "Finance-gZH4",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance-pvbh",
      "indexPipeline" : "Finance-2H1u",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr",
      "indexPipeline" : "Finance_signals_aggr",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr-osly",
      "indexPipeline" : "Finance_signals_aggr-yrPd",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr-Znks",
      "indexPipeline" : "Finance_signals_aggr-UJqy",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    }, {
      "id" : "Finance-1iCJ",
      "indexPipeline" : "Finance-kvED",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr-8Hus",
      "indexPipeline" : "Finance_signals_aggr-gcGI",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    }, {
      "id" : "Finance-fgwn",
      "indexPipeline" : "Finance-ltNG",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance-fkfw",
      "indexPipeline" : "Finance-yYr1",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance-qpn2",
      "indexPipeline" : "Finance-LVOx",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance",
      "indexPipeline" : "Finance",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance_signals-zz8q",
      "indexPipeline" : "Finance_signals-1Clu",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "Finance-uDja",
      "indexPipeline" : "Finance-pQGM",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr-TojC",
      "indexPipeline" : "Finance_signals_aggr-b3Aq",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    }, {
      "id" : "Finance-NYdY",
      "indexPipeline" : "Finance-CMOp",
      "collection" : "Finance",
      "parser" : "Finance",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr-SJ92",
      "indexPipeline" : "Finance_signals_aggr-pwtm",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    }, {
      "id" : "Finance_signals-ldyf",
      "indexPipeline" : "Finance_signals-aifV",
      "collection" : "Finance_signals",
      "params" : [ ]
    }, {
      "id" : "dave_temp",
      "indexPipeline" : "dave_temp",
      "collection" : "dave_temp",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr-mfVV",
      "indexPipeline" : "Finance_signals_aggr-ibFL",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr-rXo9",
      "indexPipeline" : "Finance_signals_aggr-Kaj3",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    }, {
      "id" : "Finance_signals_aggr-fm3d",
      "indexPipeline" : "Finance_signals_aggr-2tmn",
      "collection" : "Finance_signals_aggr",
      "params" : [ ]
    } ],
    "queryProfiles" : [ {
      "id" : "user-companies",
      "queryPipeline" : "buckets",
      "collection" : "Finance",
      "searchHandler" : "select"
    }, {
      "id" : "Finance_signals-ypMw",
      "queryPipeline" : "Finance_signals-9ksi",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals",
      "queryPipeline" : "Finance_signals",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals_aggr-9hTR",
      "queryPipeline" : "Finance_signals_aggr-jy1e",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance-Yyat",
      "queryPipeline" : "Finance-lDZd",
      "collection" : "Finance",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals-jJln",
      "queryPipeline" : "Finance_signals-NqKD",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance-hqLw",
      "queryPipeline" : "Finance-Hbmb",
      "collection" : "Finance",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals_aggr-vEYb",
      "queryPipeline" : "Finance_signals_aggr-CoCd",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals-qHBw",
      "queryPipeline" : "Finance_signals-hKyc",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals_aggr",
      "queryPipeline" : "Finance_signals_aggr",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals-LmEH",
      "queryPipeline" : "Finance_signals-STPg",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance-c3f7",
      "queryPipeline" : "Finance-5nq0",
      "collection" : "Finance",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals_aggr-eg8N",
      "queryPipeline" : "Finance_signals_aggr-SxLb",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance-rmR5",
      "queryPipeline" : "Finance-alXa",
      "collection" : "Finance",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals_aggr-xYIQ",
      "queryPipeline" : "Finance_signals_aggr-gdz2",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance-RnOe",
      "queryPipeline" : "Finance-s8xv",
      "collection" : "Finance",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals_aggr-otq7",
      "queryPipeline" : "Finance_signals_aggr-6J1i",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals-rxa7",
      "queryPipeline" : "Finance_signals-4Cz7",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance",
      "queryPipeline" : "Finance",
      "collection" : "Finance",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals-Eg8h",
      "queryPipeline" : "Finance_signals-LK9v",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "suggest",
      "queryPipeline" : "suggest",
      "collection" : "Finance",
      "searchHandler" : "suggest"
    }, {
      "id" : "latest-news",
      "queryPipeline" : "latest-news",
      "collection" : "Finance",
      "searchHandler" : "select"
    }, {
      "id" : "Finance_signals_aggr-ZAKU",
      "queryPipeline" : "Finance_signals_aggr-TjPL",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals-zx0H",
      "queryPipeline" : "Finance_signals-RctO",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance-HEpj",
      "queryPipeline" : "Finance-ZpW6",
      "collection" : "Finance",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals_aggr-XwCW",
      "queryPipeline" : "Finance_signals_aggr-3ffH",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals-mq0Y",
      "queryPipeline" : "Finance_signals-ou1v",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals-Fklj",
      "queryPipeline" : "Finance_signals-Eh6e",
      "collection" : "Finance_signals",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals_aggr-I5Tj",
      "queryPipeline" : "Finance_signals_aggr-OFSC",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    }, {
      "id" : "Finance_signals_aggr-7Xg2",
      "queryPipeline" : "Finance_signals_aggr-jKAY",
      "collection" : "Finance_signals_aggr",
      "searchHandler" : "/select"
    } ],
    "parsers" : [ {
      "id" : "sp500",
      "enableMediaTypeDetection" : true,
      "maxParserDepth" : 16,
      "parserStages" : [ {
        "type" : "csv",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ {
          "syntax" : "regex",
          "pattern" : ".*\\.csv"
        } ],
        "errorHandling" : "mark",
        "id" : "6c204381-72e8-4960-b927-d0ed246e474c",
        "charset" : "detect",
        "ignoreBOM" : false,
        "autoDetect" : true,
        "hasHeaders" : true,
        "headers" : [ ],
        "fillValue" : "<FILL>",
        "trimWhitespace" : true,
        "skipEmptyLines" : true,
        "includeRowNumber" : true,
        "commentHandling" : "ignore",
        "maxRowLength" : 10485760,
        "maxNumColumns" : 1000,
        "maxColumnChars" : 10485760,
        "columnHandling" : "default",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      } ]
    }, {
      "id" : "sp500-key-stats",
      "enableMediaTypeDetection" : true,
      "maxParserDepth" : 16,
      "parserStages" : [ {
        "type" : "csv",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ {
          "syntax" : "regex",
          "pattern" : ".*\\.csv"
        } ],
        "errorHandling" : "mark",
        "id" : "baec2de8-00a0-42fb-be77-d72b1603625d",
        "charset" : "detect",
        "ignoreBOM" : false,
        "autoDetect" : true,
        "hasHeaders" : true,
        "headers" : [ ],
        "fillValue" : "<FILL>",
        "trimWhitespace" : true,
        "skipEmptyLines" : true,
        "includeRowNumber" : true,
        "commentHandling" : "ignore",
        "maxRowLength" : 10485760,
        "maxNumColumns" : 1000,
        "maxColumnChars" : 10485760,
        "columnHandling" : "default",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      } ],
      "editPanel" : { }
    }, {
      "id" : "Finance",
      "enableMediaTypeDetection" : true,
      "maxParserDepth" : 16,
      "parserStages" : [ {
        "type" : "archive",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "44a1557b-f069-4e0b-bd94-84ade7261729",
        "alwaysDetect" : true,
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "csv",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "0acede47-ef8a-414a-8e51-f811f68ccfe7",
        "charset" : "detect",
        "ignoreBOM" : false,
        "autoDetect" : true,
        "hasHeaders" : true,
        "headers" : [ ],
        "fillValue" : "<FILL>",
        "trimWhitespace" : true,
        "skipEmptyLines" : true,
        "includeRowNumber" : true,
        "commentHandling" : "ignore",
        "maxRowLength" : 10485760,
        "maxNumColumns" : 1000,
        "maxColumnChars" : 10485760,
        "columnHandling" : "default",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "json",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "178fd9b2-a413-4632-b9b6-248c7c29f8dd",
        "splitArrays" : true,
        "includePath" : false,
        "mappings" : [ ],
        "listHandling" : "multivalued",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "xml",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "152e6268-210b-4b26-a307-4dc2a9de7612",
        "rootPaths" : [ "/" ],
        "maxSize" : 65536,
        "listHandling" : "multivalued",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "html",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "a735805c-4381-43fe-ac0d-7bb0efc58476",
        "charset" : "detect",
        "mappings" : [ ],
        "keepParent" : true,
        "extractHtmlLinks" : false,
        "extractBodyText" : true,
        "metatagsPrefix" : "",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "text",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "1f8407ae-c6ec-49d3-b3c7-ef7c3e2e2616",
        "charset" : "detect",
        "ignoreBOM" : false,
        "maxLength" : 1048576,
        "maxLineLength" : 1048576,
        "outputField" : "body",
        "splitLines" : false,
        "skipEmptyLines" : false,
        "skipHeaderLines" : 0,
        "trimWhitespace" : false,
        "commentHandling" : "include",
        "comment" : "#",
        "commentField" : "comment",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "tika",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "5c71fe84-dadc-4e0e-90bf-501102a51b0d",
        "includeImages" : false,
        "flattenCompound" : true,
        "addFailedDocs" : false,
        "addOriginalContent" : false,
        "contentEncoding" : "binary",
        "returnXml" : false,
        "keepOriginalStructure" : false,
        "extractHtmlLinks" : false,
        "extractOtherLinks" : false,
        "excludeContentTypes" : [ ],
        "zipBombCompressionRatio" : 200,
        "zipBombMaxDepth" : 200,
        "zipBombMaxPackageEntryDepth" : 20,
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "fallback",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "9964ee3c-5b5f-438e-84fb-942314b0c5ad",
        "metadataOnly" : false,
        "maxBytesToKeep" : 1048576,
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      } ]
    }, {
      "id" : "trit-response-parser",
      "enableMediaTypeDetection" : true,
      "maxParserDepth" : 16,
      "parserStages" : [ {
        "type" : "json",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "eb2537e3-6661-449d-ac1f-d8e18d4f8b2c",
        "splitArrays" : true,
        "includePath" : false,
        "mappings" : [ ],
        "listHandling" : "multivalued",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      } ],
      "editPanel" : { }
    }, {
      "id" : "sp500-historical",
      "enableMediaTypeDetection" : true,
      "maxParserDepth" : 16,
      "parserStages" : [ {
        "type" : "csv",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ {
          "syntax" : "regex",
          "pattern" : ".*\\.csv"
        } ],
        "errorHandling" : "mark",
        "id" : "29243299-36d4-42ac-adce-ad49f75210bc",
        "charset" : "detect",
        "ignoreBOM" : false,
        "autoDetect" : true,
        "hasHeaders" : true,
        "headers" : [ ],
        "fillValue" : "<FILL>",
        "trimWhitespace" : true,
        "skipEmptyLines" : true,
        "includeRowNumber" : true,
        "commentHandling" : "ignore",
        "maxRowLength" : 10485760,
        "maxNumColumns" : 1000,
        "maxColumnChars" : 10485760,
        "columnHandling" : "default",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      } ],
      "editPanel" : { }
    }, {
      "id" : "yahoo-news",
      "enableMediaTypeDetection" : true,
      "maxParserDepth" : 16,
      "parserStages" : [ {
        "type" : "archive",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "18e179db-4170-4c5a-a9ab-adbce723f66f",
        "alwaysDetect" : true,
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "csv",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "5022e023-2c71-408e-820b-1912d3686c5c",
        "charset" : "detect",
        "ignoreBOM" : false,
        "autoDetect" : true,
        "hasHeaders" : true,
        "headers" : [ ],
        "fillValue" : "<FILL>",
        "trimWhitespace" : true,
        "skipEmptyLines" : true,
        "includeRowNumber" : true,
        "commentHandling" : "ignore",
        "maxRowLength" : 10485760,
        "maxNumColumns" : 1000,
        "maxColumnChars" : 10485760,
        "columnHandling" : "default",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "json",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "2cc96480-ec8a-42a0-8194-e2595fc94609",
        "splitArrays" : true,
        "includePath" : false,
        "mappings" : [ ],
        "listHandling" : "multivalued",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "xml",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "839459a6-b23a-4bf4-acc6-981f5471888f",
        "rootPaths" : [ "/" ],
        "maxSize" : 65536,
        "listHandling" : "multivalued",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "html",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "8f055802-9dca-48be-8dfb-a9492626df7a",
        "charset" : "detect",
        "mappings" : [ ],
        "keepParent" : true,
        "extractHtmlLinks" : false,
        "extractBodyText" : true,
        "metatagsPrefix" : "",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "text",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "1648737d-2a88-415c-baea-0db0a73b5c8e",
        "charset" : "detect",
        "ignoreBOM" : false,
        "maxLength" : 1048576,
        "maxLineLength" : 1048576,
        "outputField" : "body",
        "splitLines" : false,
        "skipEmptyLines" : false,
        "skipHeaderLines" : 0,
        "trimWhitespace" : false,
        "commentHandling" : "include",
        "comment" : "#",
        "commentField" : "comment",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "tika",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "cf539f3b-0041-469e-885b-8fdb8cb88a0e",
        "includeImages" : false,
        "flattenCompound" : true,
        "addFailedDocs" : false,
        "addOriginalContent" : false,
        "contentEncoding" : "binary",
        "returnXml" : false,
        "keepOriginalStructure" : false,
        "extractHtmlLinks" : false,
        "extractOtherLinks" : false,
        "excludeContentTypes" : [ ],
        "zipBombCompressionRatio" : 200,
        "zipBombMaxDepth" : 200,
        "zipBombMaxPackageEntryDepth" : 20,
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      }, {
        "type" : "fallback",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ ],
        "errorHandling" : "mark",
        "id" : "21afff00-2f51-457f-84b8-2fdab4727c80",
        "metadataOnly" : false,
        "maxBytesToKeep" : 1048576,
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      } ]
    }, {
      "id" : "user_buckets",
      "enableMediaTypeDetection" : true,
      "maxParserDepth" : 16,
      "parserStages" : [ {
        "type" : "csv",
        "enabled" : true,
        "mediaTypes" : [ ],
        "pathPatterns" : [ {
          "syntax" : "regex",
          "pattern" : ".*\\.csv"
        } ],
        "errorHandling" : "mark",
        "id" : "03c43dec-f21f-4190-ae48-3efd5ea344f1",
        "charset" : "detect",
        "ignoreBOM" : false,
        "autoDetect" : true,
        "hasHeaders" : true,
        "headers" : [ ],
        "fillValue" : "<FILL>",
        "trimWhitespace" : true,
        "skipEmptyLines" : true,
        "includeRowNumber" : true,
        "commentHandling" : "ignore",
        "maxRowLength" : 10485760,
        "maxNumColumns" : 1000,
        "maxColumnChars" : 10485760,
        "columnHandling" : "default",
        "inheritMediaTypes" : true,
        "outputFieldPrefix" : ""
      } ],
      "editPanel" : { }
    } ],
    "objectGroups" : [ {
      "id" : "d88c67ab-fa60-44c6-b35a-5ca8b41313c6",
      "name" : "signals-Finance",
      "isSystem" : true,
      "description" : "Collection 'Finance' objects for signals support"
    } ],
    "links" : [ {
      "subject" : "query-profile:Finance_signals-qHBw",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr-hZD9",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-pipeline:Finance",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals-lBdn",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "parser:yahoo-news",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance-c3f7",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "parser:Finance",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-pipeline:sp500-key-stats",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-fgwn",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr-I5Tj",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:user_buckets",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals-Eg8h",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr-ZAKU",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:user_buckets",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals-fIEO",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-pipeline:finance-default",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:dave_temp",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr-xYIQ",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr-9hTR",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-fkfw",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-uDja",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "group:d88c67ab-fa60-44c6-b35a-5ca8b41313c6",
      "object" : "spark:Finance_head_tail",
      "linkType" : "hasPart",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr-fm3d",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-pipeline:Finance_signals",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-bMgT",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-1iCJ",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-pipeline:buckets",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "group:d88c67ab-fa60-44c6-b35a-5ca8b41313c6",
      "object" : "spark:Finance_click_signals_aggregation",
      "linkType" : "hasPart",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:sp500",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "parser:sp500",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:suggest",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "collection:Finance_signals",
      "object" : "index-pipeline:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "collection:Finance_signals_aggr",
      "object" : "query-pipeline:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals-ypMw",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:sp500",
      "object" : "index-pipeline:sp500",
      "linkType" : "dependsOn",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-wdTQ",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals-rxa7",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-wdTQ",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-pipeline:sp500",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals-9qAH",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr-eg8N",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "collection:Finance_signals_aggr",
      "object" : "index-pipeline:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-cUlP",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr",
      "object" : "index-pipeline:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-NYdY",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:user-companies",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "collection:Finance",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr-7Xg2",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr-TojC",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:yahoo-news",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance",
      "object" : "index-pipeline:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-pipeline:sp500-historical",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "parser:trit-response-parser",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr",
      "object" : "query-pipeline:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "group:d88c67ab-fa60-44c6-b35a-5ca8b41313c6",
      "object" : "spark:Finance_session_rollup",
      "linkType" : "hasPart",
      "originator" : "unspecified"
    }, {
      "subject" : "collection:Finance",
      "object" : "index-pipeline:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals-JUwc",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-pvbh",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-fgwn",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:suggest",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals-Fpkw",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-qpn2",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:user-companies",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "group:d88c67ab-fa60-44c6-b35a-5ca8b41313c6",
      "object" : "collection:Finance_signals",
      "linkType" : "hasPart",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-fkfw",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:latest-news",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr-Znks",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals-jJln",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals",
      "object" : "index-pipeline:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-qpn2",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:sp500",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:suggest",
      "object" : "query-pipeline:suggest",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals-Roet",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr-SJ92",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr-XwCW",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr-mfVV",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:tempsp500",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals-mq0Y",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals-zx0H",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-pipeline:yahoo-news",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "app:Finance",
      "object" : "group:_shared",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "parser:sp500-key-stats",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "collection:Finance",
      "object" : "query-pipeline:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "parser:sp500-historical",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr-rXo9",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-pipeline:latest-news",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals-zz8q",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr-vEYb",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-pvbh",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-1iCJ",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "group:d88c67ab-fa60-44c6-b35a-5ca8b41313c6",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:user_buckets",
      "object" : "index-pipeline:user_buckets",
      "linkType" : "dependsOn",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance-rmR5",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance-hqLw",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:latest-news",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-NYdY",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance-HEpj",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance-RnOe",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-uDja",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals_aggr-otq7",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance-Yyat",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:yahoo-news",
      "object" : "index-pipeline:yahoo-news",
      "linkType" : "dependsOn",
      "originator" : "unspecified"
    }, {
      "subject" : "query-pipeline:suggest",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "parser:user_buckets",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "group:d88c67ab-fa60-44c6-b35a-5ca8b41313c6",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "hasPart",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:tempsp500",
      "object" : "parser:Finance",
      "linkType" : "dependsOn",
      "originator" : "unspecified"
    }, {
      "subject" : "group:d88c67ab-fa60-44c6-b35a-5ca8b41313c6",
      "object" : "spark:Finance_user_item_preferences_aggregation",
      "linkType" : "hasPart",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr-8Hus",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-cUlP",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:user-companies",
      "object" : "query-pipeline:buckets",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:latest-news",
      "object" : "query-pipeline:latest-news",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:yahoo-news",
      "object" : "parser:yahoo-news",
      "linkType" : "dependsOn",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals_aggr-osly",
      "object" : "collection:Finance_signals_aggr",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals-ldyf",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:yahoo-news",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:sp500",
      "object" : "parser:sp500",
      "linkType" : "dependsOn",
      "originator" : "unspecified"
    }, {
      "subject" : "query-pipeline:queries-facets",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance",
      "object" : "query-pipeline:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals-Fklj",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-pipeline:user_buckets",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:sp500-historical",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance-bMgT",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "group:d88c67ab-fa60-44c6-b35a-5ca8b41313c6",
      "object" : "spark:Finance_user_query_history_aggregation",
      "linkType" : "hasPart",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance",
      "object" : "app:Finance",
      "linkType" : "inContextOf",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals-LmEH",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "index-profile:Finance_signals-A2dV",
      "object" : "collection:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "collection:Finance_signals",
      "object" : "query-pipeline:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:sp500-historical",
      "object" : "collection:Finance",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    }, {
      "subject" : "datasource:user_buckets",
      "object" : "parser:user_buckets",
      "linkType" : "dependsOn",
      "originator" : "unspecified"
    }, {
      "subject" : "query-profile:Finance_signals",
      "object" : "query-pipeline:Finance_signals",
      "linkType" : "relatesTo",
      "originator" : "unspecified"
    } ],
    "jobs" : [ {
      "resource" : "spark:Finance_head_tail",
      "enabled" : true,
      "triggers" : [ {
        "type" : "interval",
        "enabled" : true,
        "interval" : 1,
        "timeUnit" : "day",
        "startTime" : "2018-09-19T16:49:55.863Z",
        "type" : "interval"
      } ],
      "default" : false
    }, {
      "resource" : "spark:Finance_user_query_history_aggregation",
      "enabled" : true,
      "triggers" : [ {
        "type" : "interval",
        "enabled" : true,
        "interval" : 1,
        "timeUnit" : "day",
        "startTime" : "2018-09-18T17:08:55.698Z",
        "type" : "interval"
      } ],
      "default" : false
    }, {
      "resource" : "spark:Finance_click_signals_aggregation",
      "enabled" : true,
      "triggers" : [ {
        "type" : "interval",
        "enabled" : true,
        "interval" : 15,
        "timeUnit" : "minute",
        "startTime" : "2018-09-18T17:04:55.310Z",
        "type" : "interval"
      } ],
      "default" : false
    }, {
      "resource" : "datasource:sp500-historical",
      "enabled" : true,
      "triggers" : [ {
        "type" : "interval",
        "enabled" : true,
        "interval" : 4,
        "timeUnit" : "hour",
        "startTime" : "2018-10-08T09:00:00.000Z",
        "type" : "interval"
      } ],
      "default" : false
    }, {
      "resource" : "spark:Finance_user_item_preferences_aggregation",
      "enabled" : true,
      "triggers" : [ {
        "type" : "interval",
        "enabled" : true,
        "interval" : 1,
        "timeUnit" : "day",
        "startTime" : "2018-09-18T17:06:55.572Z",
        "type" : "interval"
      } ],
      "default" : false
    }, {
      "resource" : "spark:Finance_session_rollup",
      "enabled" : true,
      "triggers" : [ {
        "type" : "interval",
        "enabled" : true,
        "interval" : 15,
        "timeUnit" : "minute",
        "startTime" : "2018-09-18T17:04:55.420Z",
        "type" : "interval"
      } ],
      "default" : false
    } ],
    "sparkJobs" : [ {
      "type" : "sql_template",
      "id" : "Finance_click_signals_aggregation",
      "inputCollection" : "Finance_signals",
      "outputCollection" : "Finance_signals_aggr",
      "sql" : "WITH sigs_with_filters AS (\n   SELECT c.query as query,\n          c.doc_id,\n          q.filters_s as filters,\n          c.type,\n          c.ref_time,\n          c.count_i,\n          c.timestamp_tdt,\n          c.weight_d\n     FROM ${inputCollection} c\n LEFT JOIN (SELECT id, filters_s FROM ${inputCollection} WHERE type='response') q ON q.id = c.fusion_query_id\n    WHERE c.type IN (${signalTypes})\n ), signal_type_groups AS (\n     SELECT SUM(count_i) AS typed_aggr_count_i,\n            query,\n            doc_id,\n            type,\n            filters,\n            time_decay(count_i, timestamp_tdt, \"30 days\", ref_time, weight_d) AS typed_weight_d\n       FROM sigs_with_filters\n   GROUP BY doc_id, query, filters, type\n ) SELECT SUM(typed_aggr_count_i) AS aggr_count_i,\n          query AS query_s,\n          query AS query_t,\n          doc_id AS doc_id_s,\n          filters AS filters_s,\n          SPLIT(filters, ' \\\\$ ') AS filters_ss,\n          weighted_sum(typed_weight_d, type, '${signalTypeWeights}') AS weight_d\n     FROM signal_type_groups\n GROUP BY query, doc_id, filters",
      "rollupSql" : "SELECT query_s,\n          query_s as query_t,\n          doc_id_s,\n          filters_s,\n          first(aggr_type_s) AS aggr_type_s,\n          SPLIT(filters_s, ' \\\\$ ') AS filters_ss,\n          SUM(weight_d) AS weight_d,\n          SUM(aggr_count_i) AS aggr_count_i\n     FROM Finance_signals_aggr\n GROUP BY query_s, doc_id_s, filters_s",
      "parameters" : [ {
        "key" : "signalTypeWeights",
        "value" : "click:1.0,cart:10.0,purchase:25.0"
      } ],
      "selectQuery" : "*:*",
      "sourceRemove" : false,
      "sourceCatchup" : true,
      "outputRollup" : true,
      "hiddenParameters" : [ {
        "key" : "signalTypes",
        "value" : "_regex/signalTypeWeights/([\\w\\-\\.]*):([\\d\\.\\-]*)(,|$)/'$1'$3/g"
      }, {
        "key" : "optimizeOutput",
        "value" : "4"
      } ],
      "skipCheckEnabled" : true,
      "notes" : "Computes an aggregated weight for each query / item combination found in the signals collection. The weight for each group is computed using an exponential time-decay on signal count (30 day half-life) and a weighted sum based on the signal type. Use the 'signalTypeWeights' parameter to set the correct signal types and weights for your dataset. The results of this job can be used to boost documents at query time using the boosting stage."
    }, {
      "type" : "headTailAnalysis",
      "id" : "Finance_head_tail",
      "randomSeed" : 1234,
      "trainingCollection" : "Finance_signals",
      "outputCollection" : "Finance_signals_aggr",
      "overwriteOutput" : true,
      "trainingDataFilterQuery" : "type:click OR type:response",
      "fieldToVectorize" : "query",
      "trainingDataFrameConfigOptions" : { },
      "analyzerConfigQuery" : "{ \"analyzers\": [ { \"name\": \"StdTokLowerStem\",\"charFilters\": [ { \"type\": \"htmlstrip\" } ],\"tokenizer\": { \"type\": \"standard\" },\"filters\": [{ \"type\": \"lowercase\" },{ \"type\": \"englishminimalstem\" }] }],\"fields\": [{ \"regex\": \".+\", \"analyzer\": \"StdTokLowerStem\" } ]}",
      "countField" : "count_i",
      "mainType" : "click",
      "filterType" : "response",
      "signalTypeField" : "type",
      "minCountMain" : 1,
      "minCountFilter" : 20,
      "queryLenThreshold" : 2,
      "userHead" : -1.0,
      "userTail" : -1.0,
      "topQ" : [ 100.0, 0.01 ],
      "trafficPerc" : [ 0.25, 0.5, 0.75 ],
      "lastTraffic" : [ 0.01 ],
      "trafficCount" : [ 5.0 ],
      "overlapThreshold" : 4,
      "lenScale" : 6,
      "overlapNumBoost" : 10.0,
      "headQueryCntBoost" : 1.0,
      "tailRewrite" : true,
      "dataFormat" : "solr",
      "trainingDataSamplingFraction" : 1.0,
      "stopwordsList" : [ ]
    }, {
      "type" : "sql_template",
      "id" : "Finance_user_query_history_aggregation",
      "inputCollection" : "Finance_signals",
      "outputCollection" : "Finance_signals_aggr",
      "sql" : "WITH signal_type_groups AS (\n    SELECT SUM(count_i) AS typed_aggr_count_i,\n           user_id,\n           query,\n           type,\n           time_decay(count_i, timestamp_tdt, \"30 days\", ref_time, weight_d) AS typed_weight_d\n      FROM ${inputCollection}\n     WHERE type IN (${signalTypes})\n  GROUP BY query, user_id, type\n ) SELECT SUM(typed_aggr_count_i) AS aggr_count_i,\n          user_id AS user_id_s,\n          query AS query_s,\n          weighted_sum(typed_weight_d, type, '${signalTypeWeights}') AS weight_d\n     FROM signal_type_groups\n GROUP BY user_id, query",
      "parameters" : [ {
        "key" : "signalTypeWeights",
        "value" : "click:1.0,cart:10.0,purchase:25.0"
      } ],
      "selectQuery" : "*:*",
      "sourceRemove" : false,
      "sourceCatchup" : true,
      "outputRollup" : true,
      "hiddenParameters" : [ {
        "key" : "signalTypes",
        "value" : "_regex/signalTypeWeights/([\\w\\-\\.]*):([\\d\\.\\-]*)(,|$)/'$1'$3/g"
      } ],
      "skipCheckEnabled" : true,
      "notes" : "Computes an aggregated weight for each user / query combination found in the signals collection. The weight for each group is computed using an exponential time-decay on signal count (30 day half-life) and a weighted sum based on the signal type. Use the 'signalTypeWeights' parameter to set the correct signal types and weights for your dataset. The results of this job can be used to boost queries for a user based on their past queries."
    }, {
      "type" : "sql_template",
      "id" : "Finance_user_item_preferences_aggregation",
      "inputCollection" : "Finance_signals",
      "outputCollection" : "Finance_signals_aggr",
      "sql" : "WITH signal_type_groups AS (\n    SELECT SUM(count_i) AS typed_aggr_count_i,\n           doc_id,\n           user_id,\n           type,\n           time_decay(count_i, timestamp_tdt, \"30 days\", ref_time, weight_d) AS typed_weight_d\n      FROM ${inputCollection}\n     WHERE type IN (${signalTypes})\n  GROUP BY user_id, doc_id, type\n ) SELECT SUM(typed_aggr_count_i) AS aggr_count_i,\n          doc_id AS doc_id_s,\n          user_id AS user_id_s,\n          weighted_sum(typed_weight_d, type, '${signalTypeWeights}') AS weight_d\n     FROM signal_type_groups\n GROUP BY doc_id, user_id",
      "parameters" : [ {
        "key" : "signalTypeWeights",
        "value" : "click:1.0,cart:10.0,purchase:25.0"
      } ],
      "selectQuery" : "*:*",
      "sourceRemove" : false,
      "sourceCatchup" : true,
      "outputRollup" : true,
      "hiddenParameters" : [ {
        "key" : "signalTypes",
        "value" : "_regex/signalTypeWeights/([\\w\\-\\.]*):([\\d\\.\\-]*)(,|$)/'$1'$3/g"
      } ],
      "skipCheckEnabled" : true,
      "notes" : "Computes an aggregated weight for each user / item combination found in the signals collection. The weight for each group is computed using an exponential time-decay on signal count (30 day half-life) and a weighted sum based on the signal type. Use the 'signalTypeWeights' parameter to set the correct signal types and weights for your dataset. The results of this job can be used as input to the ALS recommendation job."
    }, {
      "type" : "sql_template",
      "id" : "Finance_session_rollup",
      "inputCollection" : "Finance_signals",
      "outputCollection" : "Finance_signals",
      "sql" : "WITH session_agg AS (\n     SELECT COUNT(1) AS activity_count,\n            MIN(timestamp_tdt) AS start,\n            MAX(timestamp_tdt) AS end,\n            timediff(MAX(timestamp_tdt), MIN(timestamp_tdt), \"MINUTES\") AS duration,\n            'session' AS type,\n            first(user_id) AS user,\n            session_keywords(query) AS keywords,\n            session\n       FROM ${inputCollection}\n      WHERE timestamp_tdt IS NOT NULL\n        AND type != 'session'\n        AND session IS NOT NULL\n        AND session NOT IN (SELECT session FROM ${inputCollection} WHERE type = 'session' AND session IS NOT NULL)\n   GROUP BY session\n     HAVING timediff(current_timestamp(), MAX(timestamp_tdt), \"SECONDS\") >= ${elapsedSecsSinceLastActivity} OR timediff(current_timestamp(), MIN(timestamp_tdt), \"SECONDS\") >= ${elapsedSecsSinceSessionStart})\n SELECT activity_count, start, end, duration, type, user, keywords, session FROM session_agg",
      "parameters" : [ {
        "key" : "elapsedSecsSinceLastActivity",
        "value" : "360"
      }, {
        "key" : "elapsedSecsSinceSessionStart",
        "value" : "3600"
      } ],
      "selectQuery" : "*:*",
      "sourceRemove" : false,
      "sourceCatchup" : false,
      "outputRollup" : false,
      "hiddenParameters" : [ {
        "key" : "outputProjectedFieldsOnly",
        "value" : "true"
      } ],
      "skipCheckEnabled" : false,
      "notes" : "Aggregate related user activity into a session signal containing activity count, duration, and keywords (based on user search terms). This job is used by the Fusion Insights application to show reports about user sessions. Use the 'elapsedSecsSinceLastActivity' and 'elapsedSecsSinceSessionStart' parameters to determine when a user session is considered to be complete."
    } ],
    "fusionApps" : [ {
      "id" : "Finance",
      "name" : "Finance",
      "description" : "Market insights discovery demo",
      "dataUri" : "/admin/App-Tile-01-460x160.png",
      "properties" : {
        "tileColor" : "apps-darkblue",
        "previousCollectionId" : "Finance"
      }
    } ],
    "dataSources" : [ {
      "id" : "sp500",
      "created" : "2018-09-18T18:30:10.136Z",
      "modified" : "2018-09-18T18:30:10.136Z",
      "connector" : "lucid.web",
      "type" : "web",
      "description" : "Reference data set for S&P 500",
      "pipeline" : "sp500",
      "parserId" : "sp500",
      "properties" : {
        "refreshOlderThan" : -1,
        "f.appendTrailingSlashToLinks" : false,
        "refreshErrors" : false,
        "restrictToTreeIgnoredHostPrefixes" : [ "www." ],
        "dedupeSaveSignature" : false,
        "crawlDBType" : "in-memory",
        "f.firefoxHeadlessBrowser" : true,
        "f.discardLinkURLQueries" : false,
        "fetchDelayMS" : 0,
        "f.respectMetaEquivRedirects" : false,
        "refreshAll" : true,
        "f.defaultMIMEType" : "application/octet-stream",
        "f.extraLoadTimeMs" : 250,
        "f.jsPageLoadTimeout" : 20000,
        "restrictToTreeAllowSubdomains" : false,
        "f.jsScriptTimeout" : 20000,
        "f.requestCounterMinWaitMs" : 5000,
        "maxItems" : -1,
        "f.jsAjaxTimeout" : 20000,
        "dedupe" : false,
        "f.scrapeLinksBeforeFiltering" : false,
        "trackEmbeddedIDs" : true,
        "f.allowAllCertificates" : false,
        "collection" : "Finance",
        "forceRefresh" : false,
        "delete404" : true,
        "f.obeyRobots" : true,
        "parserRetryCount" : 0,
        "f.quitTimeoutMs" : 5000,
        "fetchDelayMSPerHost" : true,
        "fetchThreads" : 5,
        "indexCrawlDBToSolr" : false,
        "f.requestRetryCount" : 0,
        "retainOutlinks" : false,
        "restrictToTree" : true,
        "f.defaultCharSet" : "UTF-8",
        "f.useRequestCounter" : true,
        "emitThreads" : 5,
        "f.headlessBrowser" : true,
        "f.useFirefox" : false,
        "f.canonicalTagsRedirectLimit" : 4,
        "f.requestCounterMaxWaitMs" : 20000,
        "diagnosticMode" : false,
        "f.followCanonicalTags" : true,
        "delete" : true,
        "initial_mapping" : {
          "mappings" : [ {
            "source" : "charSet",
            "operation" : "move",
            "target" : "charSet_s"
          }, {
            "source" : "fetchedDate",
            "operation" : "move",
            "target" : "fetchedDate_dt"
          }, {
            "source" : "lastModified",
            "operation" : "move",
            "target" : "lastModified_dt"
          }, {
            "source" : "signature",
            "operation" : "move",
            "target" : "dedupeSignature_s"
          }, {
            "source" : "contentSignature",
            "operation" : "move",
            "target" : "signature_s"
          }, {
            "source" : "length",
            "operation" : "move",
            "target" : "length_l"
          }, {
            "source" : "mimeType",
            "operation" : "move",
            "target" : "mimeType_s"
          }, {
            "source" : "parent",
            "operation" : "move",
            "target" : "parent_s"
          }, {
            "source" : "owner",
            "operation" : "move",
            "target" : "owner_s"
          }, {
            "source" : "group",
            "operation" : "move",
            "target" : "group_s"
          } ],
          "reservedFieldsMappingAllowed" : false,
          "skip" : false,
          "id" : "FromMap",
          "type" : "field-mapping"
        },
        "f.extraPageLoadDeltaChars" : 0,
        "restrictToTreeUseHostAndPath" : false,
        "sitemap_incremental_crawling" : false,
        "f.screenshotFullscreen" : false,
        "f.filteringRootTags" : [ "body", "head" ],
        "startLinks" : [ "http://localhost:8780/data/Finance/sp500.csv" ],
        "failFastOnStartLinkFailure" : true,
        "f.timeoutMS" : 10000,
        "f.discardLinkURLAnchors" : true,
        "chunkSize" : 1,
        "f.simulateMobile" : false,
        "f.obeyRobotsDelay" : true,
        "f.useHighPerfJsEval" : false,
        "deleteErrorsAfter" : -1,
        "f.userAgentName" : "Lucidworks-Anda/2.0",
        "retryEmit" : true,
        "f.crawlJS" : false,
        "depth" : -1,
        "f.cookieSpec" : "browser-compatibility",
        "refreshStartLinks" : false,
        "f.maxSizeBytes" : 4194304,
        "aliasExpiration" : 1,
        "f.takeScreenshot" : false
      }
    }, {
      "id" : "tempsp500",
      "created" : "2018-10-08T02:50:13.311Z",
      "modified" : "2018-10-08T02:50:13.311Z",
      "connector" : "lucid.fileupload",
      "type" : "fileupload",
      "pipeline" : "dave_temp",
      "parserId" : "Finance",
      "properties" : {
        "mediaType" : "application/octet-stream",
        "collection" : "dave_temp",
        "fileId" : "sp500_new.csv"
      }
    }, {
      "id" : "sp500-historical",
      "created" : "2018-09-18T18:42:29.437Z",
      "modified" : "2018-09-18T18:42:29.437Z",
      "connector" : "lucid.web",
      "type" : "web",
      "description" : "S&P 500 historical stock prices",
      "pipeline" : "sp500-historical",
      "parserId" : "sp500-historical",
      "properties" : {
        "refreshOlderThan" : -1,
        "f.appendTrailingSlashToLinks" : false,
        "refreshErrors" : false,
        "restrictToTreeIgnoredHostPrefixes" : [ "www." ],
        "dedupeSaveSignature" : false,
        "crawlDBType" : "in-memory",
        "f.firefoxHeadlessBrowser" : true,
        "f.discardLinkURLQueries" : false,
        "fetchDelayMS" : 0,
        "f.respectMetaEquivRedirects" : false,
        "refreshAll" : true,
        "f.defaultMIMEType" : "application/octet-stream",
        "f.extraLoadTimeMs" : 250,
        "f.jsPageLoadTimeout" : 20000,
        "restrictToTreeAllowSubdomains" : false,
        "f.jsScriptTimeout" : 20000,
        "f.requestCounterMinWaitMs" : 5000,
        "f.jsAjaxTimeout" : 20000,
        "maxItems" : -1,
        "dedupe" : false,
        "f.scrapeLinksBeforeFiltering" : false,
        "trackEmbeddedIDs" : true,
        "f.allowAllCertificates" : false,
        "collection" : "Finance",
        "forceRefresh" : false,
        "delete404" : true,
        "f.obeyRobots" : true,
        "parserRetryCount" : 0,
        "f.quitTimeoutMs" : 5000,
        "fetchDelayMSPerHost" : true,
        "indexCrawlDBToSolr" : false,
        "f.requestRetryCount" : 0,
        "fetchThreads" : 1,
        "retainOutlinks" : false,
        "restrictToTree" : true,
        "f.defaultCharSet" : "UTF-8",
        "f.useRequestCounter" : true,
        "emitThreads" : 5,
        "f.headlessBrowser" : true,
        "f.useFirefox" : false,
        "f.canonicalTagsRedirectLimit" : 4,
        "f.requestCounterMaxWaitMs" : 20000,
        "diagnosticMode" : false,
        "f.followCanonicalTags" : true,
        "delete" : true,
        "initial_mapping" : {
          "mappings" : [ {
            "source" : "charSet",
            "operation" : "move",
            "target" : "charSet_s"
          }, {
            "source" : "fetchedDate",
            "operation" : "move",
            "target" : "fetchedDate_dt"
          }, {
            "source" : "lastModified",
            "operation" : "move",
            "target" : "lastModified_dt"
          }, {
            "source" : "signature",
            "operation" : "move",
            "target" : "dedupeSignature_s"
          }, {
            "source" : "contentSignature",
            "operation" : "move",
            "target" : "signature_s"
          }, {
            "source" : "length",
            "operation" : "move",
            "target" : "length_l"
          }, {
            "source" : "mimeType",
            "operation" : "move",
            "target" : "mimeType_s"
          }, {
            "source" : "parent",
            "operation" : "move",
            "target" : "parent_s"
          }, {
            "source" : "owner",
            "operation" : "move",
            "target" : "owner_s"
          }, {
            "source" : "group",
            "operation" : "move",
            "target" : "group_s"
          } ],
          "reservedFieldsMappingAllowed" : false,
          "skip" : false,
          "id" : "FromMap",
          "type" : "field-mapping"
        },
        "f.extraPageLoadDeltaChars" : 0,
        "restrictToTreeUseHostAndPath" : false,
        "sitemap_incremental_crawling" : false,
        "f.screenshotFullscreen" : false,
        "f.filteringRootTags" : [ "body", "head" ],
        "startLinks" : [ "http://localhost:8780/data/Finance/sp500.csv" ],
        "failFastOnStartLinkFailure" : true,
        "f.timeoutMS" : 10000,
        "f.discardLinkURLAnchors" : true,
        "chunkSize" : 1,
        "f.simulateMobile" : false,
        "f.obeyRobotsDelay" : true,
        "f.useHighPerfJsEval" : false,
        "deleteErrorsAfter" : -1,
        "f.userAgentName" : "Lucidworks-Anda/2.0",
        "retryEmit" : true,
        "f.crawlJS" : false,
        "depth" : -1,
        "f.cookieSpec" : "browser-compatibility",
        "refreshStartLinks" : false,
        "f.maxSizeBytes" : 4194304,
        "aliasExpiration" : 1,
        "f.takeScreenshot" : false
      }
    }, {
      "id" : "yahoo-news",
      "created" : "2018-10-01T14:42:38.844Z",
      "modified" : "2018-10-01T14:42:38.844Z",
      "connector" : "lucid.web",
      "type" : "web",
      "pipeline" : "yahoo-news",
      "parserId" : "yahoo-news",
      "properties" : {
        "refreshOlderThan" : -1,
        "f.sitemapURLs" : [ ],
        "f.appendTrailingSlashToLinks" : false,
        "restrictToTreeIgnoredHostPrefixes" : [ ],
        "refreshErrors" : false,
        "dedupeSaveSignature" : false,
        "crawlDBType" : "in-memory",
        "f.firefoxHeadlessBrowser" : true,
        "f.discardLinkURLQueries" : false,
        "f.respectMetaEquivRedirects" : false,
        "fetchDelayMS" : 200,
        "refreshAll" : true,
        "f.defaultMIMEType" : "application/octet-stream",
        "f.extraLoadTimeMs" : 250,
        "f.jsPageLoadTimeout" : 20000,
        "restrictToTreeAllowSubdomains" : false,
        "f.jsScriptTimeout" : 20000,
        "f.requestCounterMinWaitMs" : 5000,
        "f.jsAjaxTimeout" : 20000,
        "maxItems" : -1,
        "trackEmbeddedIDs" : true,
        "dedupe" : false,
        "f.scrapeLinksBeforeFiltering" : false,
        "f.allowAllCertificates" : false,
        "collection" : "Finance",
        "forceRefresh" : false,
        "delete404" : true,
        "f.obeyRobots" : false,
        "parserRetryCount" : 0,
        "f.quitTimeoutMs" : 5000,
        "fetchDelayMSPerHost" : false,
        "fetchThreads" : 1,
        "indexCrawlDBToSolr" : false,
        "f.requestRetryCount" : 0,
        "restrictToTree" : false,
        "retainOutlinks" : false,
        "f.defaultCharSet" : "UTF-8",
        "f.useRequestCounter" : true,
        "emitThreads" : 1,
        "f.headlessBrowser" : true,
        "f.useFirefox" : false,
        "f.canonicalTagsRedirectLimit" : 4,
        "diagnosticMode" : false,
        "f.requestCounterMaxWaitMs" : 20000,
        "f.followCanonicalTags" : true,
        "delete" : true,
        "initial_mapping" : {
          "mappings" : [ {
            "source" : "charSet",
            "operation" : "move",
            "target" : "charSet_s"
          }, {
            "source" : "fetchedDate",
            "operation" : "move",
            "target" : "fetchedDate_dt"
          }, {
            "source" : "lastModified",
            "operation" : "move",
            "target" : "lastModified_dt"
          }, {
            "source" : "signature",
            "operation" : "move",
            "target" : "dedupeSignature_s"
          }, {
            "source" : "contentSignature",
            "operation" : "move",
            "target" : "signature_s"
          }, {
            "source" : "length",
            "operation" : "move",
            "target" : "length_l"
          }, {
            "source" : "mimeType",
            "operation" : "move",
            "target" : "mimeType_s"
          }, {
            "source" : "parent",
            "operation" : "move",
            "target" : "parent_s"
          }, {
            "source" : "owner",
            "operation" : "move",
            "target" : "owner_s"
          }, {
            "source" : "group",
            "operation" : "move",
            "target" : "group_s"
          } ],
          "reservedFieldsMappingAllowed" : false,
          "skip" : false,
          "id" : "FromMap",
          "type" : "field-mapping"
        },
        "f.extraPageLoadDeltaChars" : 0,
        "restrictToTreeUseHostAndPath" : false,
        "sitemap_incremental_crawling" : false,
        "f.screenshotFullscreen" : false,
        "f.filteringRootTags" : [ "body", "head" ],
        "startLinks" : [ "https://finance.yahoo.com/" ],
        "failFastOnStartLinkFailure" : true,
        "f.timeoutMS" : 10000,
        "f.discardLinkURLAnchors" : true,
        "includeRegexes" : [ ],
        "chunkSize" : 1,
        "f.simulateMobile" : false,
        "f.obeyRobotsDelay" : true,
        "f.useHighPerfJsEval" : false,
        "deleteErrorsAfter" : -1,
        "f.userAgentName" : "Lucidworks-Anda/2.0",
        "retryEmit" : true,
        "f.crawlJS" : false,
        "depth" : -1,
        "f.cookieSpec" : "browser-compatibility",
        "f.maxSizeBytes" : 4194304,
        "refreshStartLinks" : false,
        "aliasExpiration" : 1,
        "f.takeScreenshot" : false
      }
    }, {
      "id" : "user_buckets",
      "created" : "2018-10-05T11:44:59.621Z",
      "modified" : "2018-10-05T11:44:59.621Z",
      "connector" : "lucid.web",
      "type" : "web",
      "pipeline" : "user_buckets",
      "parserId" : "user_buckets",
      "properties" : {
        "refreshOlderThan" : -1,
        "f.appendTrailingSlashToLinks" : false,
        "refreshErrors" : false,
        "restrictToTreeIgnoredHostPrefixes" : [ "www." ],
        "dedupeSaveSignature" : false,
        "crawlDBType" : "in-memory",
        "f.firefoxHeadlessBrowser" : true,
        "f.discardLinkURLQueries" : false,
        "fetchDelayMS" : 0,
        "f.respectMetaEquivRedirects" : false,
        "refreshAll" : true,
        "f.defaultMIMEType" : "application/octet-stream",
        "f.extraLoadTimeMs" : 250,
        "f.jsPageLoadTimeout" : 20000,
        "restrictToTreeAllowSubdomains" : false,
        "f.jsScriptTimeout" : 20000,
        "f.requestCounterMinWaitMs" : 5000,
        "maxItems" : -1,
        "f.jsAjaxTimeout" : 20000,
        "dedupe" : false,
        "f.scrapeLinksBeforeFiltering" : false,
        "trackEmbeddedIDs" : true,
        "f.allowAllCertificates" : false,
        "collection" : "Finance",
        "forceRefresh" : false,
        "delete404" : true,
        "f.obeyRobots" : true,
        "parserRetryCount" : 0,
        "f.quitTimeoutMs" : 5000,
        "fetchDelayMSPerHost" : true,
        "fetchThreads" : 5,
        "indexCrawlDBToSolr" : false,
        "f.requestRetryCount" : 0,
        "retainOutlinks" : false,
        "restrictToTree" : true,
        "f.defaultCharSet" : "UTF-8",
        "f.useRequestCounter" : true,
        "emitThreads" : 5,
        "f.headlessBrowser" : true,
        "f.useFirefox" : false,
        "f.canonicalTagsRedirectLimit" : 4,
        "f.requestCounterMaxWaitMs" : 20000,
        "diagnosticMode" : false,
        "f.followCanonicalTags" : true,
        "delete" : true,
        "initial_mapping" : {
          "mappings" : [ {
            "source" : "charSet",
            "operation" : "move",
            "target" : "charSet_s"
          }, {
            "source" : "fetchedDate",
            "operation" : "move",
            "target" : "fetchedDate_dt"
          }, {
            "source" : "lastModified",
            "operation" : "move",
            "target" : "lastModified_dt"
          }, {
            "source" : "signature",
            "operation" : "move",
            "target" : "dedupeSignature_s"
          }, {
            "source" : "contentSignature",
            "operation" : "move",
            "target" : "signature_s"
          }, {
            "source" : "length",
            "operation" : "move",
            "target" : "length_l"
          }, {
            "source" : "mimeType",
            "operation" : "move",
            "target" : "mimeType_s"
          }, {
            "source" : "parent",
            "operation" : "move",
            "target" : "parent_s"
          }, {
            "source" : "owner",
            "operation" : "move",
            "target" : "owner_s"
          }, {
            "source" : "group",
            "operation" : "move",
            "target" : "group_s"
          } ],
          "reservedFieldsMappingAllowed" : false,
          "skip" : false,
          "id" : "FromMap",
          "type" : "field-mapping"
        },
        "f.extraPageLoadDeltaChars" : 0,
        "restrictToTreeUseHostAndPath" : false,
        "sitemap_incremental_crawling" : false,
        "f.screenshotFullscreen" : false,
        "f.filteringRootTags" : [ "body", "head" ],
        "startLinks" : [ "http://localhost:8780/data/Finance/company_buckets.csv" ],
        "failFastOnStartLinkFailure" : true,
        "f.timeoutMS" : 10000,
        "f.discardLinkURLAnchors" : true,
        "chunkSize" : 1,
        "f.simulateMobile" : false,
        "f.obeyRobotsDelay" : true,
        "f.useHighPerfJsEval" : false,
        "deleteErrorsAfter" : -1,
        "f.userAgentName" : "Lucidworks-Anda/2.0",
        "retryEmit" : true,
        "f.crawlJS" : false,
        "depth" : -1,
        "f.cookieSpec" : "browser-compatibility",
        "refreshStartLinks" : false,
        "f.maxSizeBytes" : 4194304,
        "aliasExpiration" : 1,
        "f.takeScreenshot" : false
      }
    } ]
  },
  "metadata" : {
    "formatVersion" : "1",
    "exportedBy" : "default-subject",
    "exportedDate" : "2018-10-09T10:13:15.736Z",
    "fusionVersion" : "4.1.0",
    "fusionGuid" : "a8cf6204-a59a-4aa8-8af3-3703bf816678"
  }
}